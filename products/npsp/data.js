export const PRODUCT = {

donations: {
  name: "Donations & Payments",
  icon: "\u{1F4B0}",
  color: "#4d8bff",
  description: "The heart of NPSP. Donations are Salesforce Opportunities with specialized nonprofit behavior. NPSP adds payment tracking via npe01__OppPayment__c, soft credits, matching gifts, tributes, and automatic rollup calculations. PMT_Payment_TDTM handles payment creation and sync, while OPP_OpportunityNaming generates names from configurable patterns.",
  components: [
    {id:"opp-naming",name:"Opportunity Naming",icon:"\u{1F3F7}",desc:"Auto-names donations using configurable patterns from donor, amount, date, record type, and campaign fields. OPP_OpportunityNaming handler runs before insert/update. OPP_OpportunityNaming_BATCH handles bulk renaming.",tags:["OPP_OpportunityNaming","OPP_OpportunityNaming_BATCH"],triggerTags:["before insert","before update"],code:{title:"OPP_OpportunityNaming.cls",lang:"Apex",body:'<span class="cm">// TDTM Handler: Automatic Opportunity Naming</span>\n<span class="kw">public class</span> <span class="ty">OPP_OpportunityNaming</span> <span class="kw">extends</span> <span class="ty">TDTM_Runnable</span> {\n\n  <span class="kw">public override</span> <span class="ty">DmlWrapper</span> <span class="fn">run</span>(\n    <span class="ty">List&lt;SObject&gt;</span> newList,\n    <span class="ty">List&lt;SObject&gt;</span> oldList,\n    <span class="ty">TDTM_Runnable.Action</span> triggerAction,\n    <span class="ty">Schema.DescribeSObjectResult</span> objResult\n  ) {\n    <span class="kw">for</span> (<span class="ty">Opportunity</span> opp : (<span class="ty">List&lt;Opportunity&gt;</span>)newList) {\n      <span class="kw">if</span> (shouldRename(opp, oldMap)) {\n        opp.Name = <span class="fn">constructName</span>(opp);\n      }\n    }\n    <span class="kw">return null</span>; <span class="cm">// before trigger, no DML needed</span>\n  }\n}'},executionFlow:["User creates/updates Opportunity","TDTM dispatcher fires OPP_OpportunityNaming (before)","Handler checks naming settings via UTIL_CustomSettingsFacade","Constructs name from configured pattern tokens","Sets Opportunity.Name before DML completes"],docs:["NPSP automatically names Opportunities (donations) when they are created from a Quick Action on a Contact or Account record. The default naming convention is the Account or Contact Name, followed by the record type name and the date, for example \"Barnaby Jones Donation 12/12/21\".","Administrators can create custom Opportunity Name formats using any fields from the Opportunity itself or from related records such as Campaign or Primary Contact. NPSP also supports different naming formats by Opportunity record type.","Custom Opportunity Names are configured in NPSP Settings under Opportunity Names. You can specify Attribution (Contact donations, Organization donations, or both), which record types the name applies to, the name format, and the date format."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_opportunity_payments.htm&language=en_US&type=5"},
    {id:"payments",name:"Payment Processing",icon:"\u{1F4B3}",desc:"Auto-creates npe01__OppPayment__c records when Opportunities are created. PMT_Payment_TDTM handles creation, sync, currency validation, and accounting data consistency enforcement. Supports writeoff, refunds, and multi-payment splitting.",tags:["PMT_Payment_TDTM","PMT_PaymentCreator","npe01__OppPayment__c"],triggerTags:["after insert","after update"],code:{title:"PMT_Payment_TDTM.cls",lang:"Apex",body:'<span class="cm">// Payment handler with settings facade pattern</span>\n<span class="kw">public class</span> <span class="ty">PMT_Payment_TDTM</span> <span class="kw">extends</span> <span class="ty">TDTM_Runnable</span> {\n\n  <span class="kw">private static final</span> <span class="ty">npo02__Households_Settings__c</span>\n    householdSettings =\n    <span class="ty">UTIL_CustomSettingsFacade</span>.<span class="fn">getHouseholdsSettings</span>();\n\n  <span class="kw">private</span> <span class="ty">Boolean</span> isEnforceAccountingDataConsistency {\n    <span class="kw">get</span> {\n      <span class="kw">if</span> (isEnforceAccountingDataConsistency == <span class="kw">null</span>) {\n        isEnforceAccountingDataConsistency =\n          <span class="ty">UTIL_CustomSettingsFacade</span>.<span class="fn">getContactsSettings</span>()\n            .Enforce_Accounting_Data_Consistency__c;\n      }\n      <span class="kw">return</span> isEnforceAccountingDataConsistency;\n    }\n    <span class="kw">set</span>;\n  }\n\n  <span class="kw">public override</span> <span class="ty">DmlWrapper</span> <span class="fn">run</span>(...) {\n    <span class="cm">// Payment creation, sync, and validation</span>\n  }\n}'},executionFlow:["Opportunity created with Amount > 0","TDTM fires PMT_Payment_TDTM (after insert)","Handler reads settings via UTIL_CustomSettingsFacade","Creates npe01__OppPayment__c linked to Opportunity","Enforces accounting data consistency if configured","Payment Amount, Date, and Paid status set automatically"],docs:["In NPSP, when you save a new Opportunity, related Payment records are automatically created. When the Stage is set to Posted, NPSP creates a Payment for the full donation amount and records the donation as paid in full.","You can override automatic Payment creation on individual Opportunities using the Do Not Automatically Create Payment checkbox, or exclude specific Opportunity record types from automatic Payments entirely. Payment Mappings allow you to automatically copy values from Opportunity fields to Payment fields.","When all Payments on an Opportunity are marked Paid, NPSP automatically updates the Opportunity Stage to the value configured in the Opportunity Stage for When Fully Paid setting. If an Opportunity Stage changes to Closed/Lost, any unpaid Payments are written off.","Payment settings are configured in NPSP Settings under Donations, Payments, where you can enable or disable automatic Payment creation, set the fully-paid stage, configure Payment field mappings, and set up refund capabilities."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_opportunity_payments.htm&language=en_US&type=5"},
    {id:"donor-stats",name:"Donor Statistics",icon:"\u{1F4C8}",desc:"Tracks giving history on Contact/Account: total gifts, largest gift, first/last gift date, giving level, consecutive years, donor streaks. Updated by CRLP rollup engine after every donation change. Fields include npo02__TotalOppAmount__c, npo02__NumberOfClosedOpps__c, npo02__Best_Gift_Year__c.",tags:["CRLP_RollupProcessor","Contact","Account"],triggerTags:["batch rollup"],code:{title:"Donor Statistics Fields",lang:"Apex",body:'<span class="cm">// Key rollup fields on Contact/Account</span>\n<span class="cm">// Automatically maintained by CRLP engine</span>\n\n<span class="ty">Contact</span> donor = [\n  <span class="kw">SELECT</span>\n    npo02__TotalOppAmount__c,        <span class="cm">// Lifetime giving</span>\n    npo02__NumberOfClosedOpps__c,     <span class="cm">// Total count</span>\n    npo02__FirstCloseDate__c,         <span class="cm">// First gift</span>\n    npo02__LastCloseDate__c,          <span class="cm">// Most recent</span>\n    npo02__LargestAmount__c,          <span class="cm">// Largest gift</span>\n    npo02__SmallestAmount__c,         <span class="cm">// Smallest gift</span>\n    npo02__AverageAmount__c,          <span class="cm">// Average gift</span>\n    npo02__Best_Gift_Year__c,         <span class="cm">// Best year</span>\n    npo02__Best_Gift_Year_Total__c    <span class="cm">// Best year $</span>\n  <span class="kw">FROM</span> <span class="ty">Contact</span>\n  <span class="kw">WHERE</span> Id = :donorId\n];'},executionFlow:["Donation created/updated/deleted","CRLP batch or trigger picks up changed records","Calculates SUM, COUNT, MIN, MAX, AVG, FIRST, LAST","Applies fiscal year and filter criteria","Updates rollup fields on parent Contact/Account"],docs:["Donor Rollup fields contain accumulated totals of donor history information such as Total Number of Gifts, Total Gifts, Average Gift Amount, Largest Gift Amount, First Gift Date, and Last Gift Date. These rollup fields appear in the Donation Information sections of Account and Contact records.","NPSP provides approximately 87 out-of-box rollups that appear on Account, Contact, Recurring Donation, and General Accounting Unit objects. With Customizable Rollups enabled, administrators can edit these default rollups or create new ones with custom filters.","Rollup calculations run as nightly batch jobs. If you need to see updated rollup values immediately, an administrator can manually recalculate rollups from the Account or Contact record, or run the Rollup Donations Batch from NPSP Settings under Bulk Data Processes."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_opportunity_payments.htm&language=en_US&type=5"},
    {id:"matching-gifts",name:"Matching Gifts",icon:"\u{1F91D}",desc:"Tracks corporate matching gift programs. MTCH_Opportunity_TDTM links a donation to a matching gift Opportunity. Supports partial match ratios and status tracking. Employment affiliations identify matching gift eligibility.",tags:["MTCH_Opportunity_TDTM","Matching_Gift__c"],triggerTags:["after update"],docs:["Matching Gifts track a donation that a corporation made as a match for a donation from one of their employees. Tracking matching gifts in Salesforce is a three-step process: identify and track matching organizations, create the matching-eligible gift from the donor, and create the matching gift from the organization.","To set up an organization for matching gifts, check the Matching Gift Company checkbox on the Account record and optionally enter details like matching gift percentage, administrator contact, and deadline information. When entering the donor's original gift, specify the Matching Gift Account and set the Matching Gift Status to Potential or Submitted.","When the matching gift check arrives, create a new Opportunity with the Matching Gift record type on the organization's Account, then use the Find Matched Gifts button to associate employee donations with the employer's matching gift. NPSP automatically creates Contact Roles for matched donors and Partial Soft Credits for the amount of each donor's original gift."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Config_Matching_Gifts.htm&language=en_US&type=5"},
    {id:"contact-roles",name:"Contact Roles",icon:"\u{1F465}",desc:"OPP_OpportunityContactRoles_TDTM and HH_OppContactRoles_TDTM manage primary and soft credit contact roles. Auto-creates OCRs for household members, enabling soft credit attribution.",tags:["OPP_OpportunityContactRoles_TDTM","HH_OppContactRoles_TDTM","OpportunityContactRole"],triggerTags:["after insert","after update"],docs:["Opportunity Contact Roles (OCRs) connect Contacts to Opportunities and define a role for each Contact, such as Donor, Household Member, Soft Credit, Matched Donor, Influencer, or Solicitor. NPSP comes with twelve out-of-box Contact Roles and administrators can create additional roles.","NPSP automatically creates OCRs in several scenarios: the Primary Contact receives the Donor role, Household members get the Household Member role for soft credits, and Contacts on Relationship or Affiliation records with a Related Opportunity Contact Role receive automated soft credit roles.","Not all OCRs count as soft credits. Which roles count as soft credits is determined by filter groups in Customizable Rollups, or by the Soft Credit Roles setting in NPSP Settings under Donations, Contact Roles for legacy rollups."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_opportunity_payments.htm&language=en_US&type=5"},
    {id:"cascade-delete",name:"Cascade Deletes",icon:"\u{1F5D1}",desc:"OPP_CascadeDeleteLookups_TDTM and PMT_CascadeDeleteLookups_TDTM implement soft cascade deletes through lookup relationships. Prevents orphaned payment records when Opportunities are deleted.",tags:["OPP_CascadeDeleteLookups_TDTM","PMT_CascadeDeleteLookups_TDTM"],triggerTags:["before delete","after delete","after undelete"]}
  ],
  dataFlow:["Donor (Contact)","Opportunity","Payment","Allocation","Rollup to Contact/Account"],
  connections:[{planet:"contacts",desc:"Donor Contact/Account provides the giving entity"},{planet:"rollups",desc:"Every donation change triggers CRLP rollup recalculation"},{planet:"allocations",desc:"Donation amount distributed across GAUs"},{planet:"softcredits",desc:"Soft credits attribute donations to additional contacts"},{planet:"recurring",desc:"Recurring Donations auto-create Opportunity records"},{planet:"giftentry",desc:"Gift Entry UI creates donations through BDI"},{planet:"tdtm",desc:"Opportunity trigger dispatches TDTM handlers"},{planet:"affiliations",desc:"Employment affiliations identify matching gift eligibility"},{planet:"engagement",desc:"Engagement plans triggered by donation events"},{planet:"bdi",desc:"BDI creates Opportunities and Payments"},{planet:"elevate",desc:"Elevate processes payment capture and refunds"}]
},

contacts: {
  name: "Contacts & Households",
  icon: "\u{1F465}",
  color: "#a855f7",
  description: "NPSP reimagines the Salesforce Account-Contact model for nonprofits. The Household Account model groups family members under a shared Account. ACCT_IndividualAccounts_TDTM is the most heavily loaded handler, firing on nearly all Contact trigger events. HH_HouseholdNaming auto-generates household names and greetings. Also supports 1:1 individual model and Organization accounts. 18 HH_ classes, 16 CON_ classes, 5 ACCT_ classes.",
  components: [
    {id:"household-model",name:"Household Account Model",icon:"\u{1F3E0}",desc:"Default NPSP model. Each household gets an Account record. ACCT_IndividualAccounts_TDTM creates/manages Household Accounts on Contact insert/update/delete. Fires on BeforeInsert, BeforeUpdate, AfterInsert, AfterUpdate, AfterDelete, AfterUndelete.",tags:["ACCT_IndividualAccounts_TDTM","Account","Contact"],triggerTags:["before insert","after insert","after update","after delete"],code:{title:"ACCT_IndividualAccounts_TDTM Registration",lang:"Apex",body:'<span class="cm">// The most heavily loaded handler in NPSP</span>\n<span class="cm">// Registered on Contact with 6 trigger actions</span>\nhandlers.add(<span class="kw">new</span> <span class="ty">Trigger_Handler__c</span>(\n  Active__c = <span class="kw">true</span>,\n  Class__c = <span class="st">\'ACCT_IndividualAccounts_TDTM\'</span>,\n  Load_Order__c = <span class="nu">1</span>,\n  Object__c = <span class="st">\'Contact\'</span>,\n  Trigger_Action__c = <span class="st">\'BeforeInsert;BeforeUpdate;\'</span>\n    + <span class="st">\'AfterInsert;AfterUpdate;\'</span>\n    + <span class="st">\'AfterDelete;AfterUndelete\'</span>\n));\n\n<span class="cm">// This handler:</span>\n<span class="cm">// - Creates Household Account when Contact has none</span>\n<span class="cm">// - Moves Contact between households on reparenting</span>\n<span class="cm">// - Updates household naming when contacts change</span>\n<span class="cm">// - Handles contact deletion cleanup</span>'},executionFlow:["Contact created without Account","ACCT_IndividualAccounts_TDTM fires (AfterInsert)","Creates new Household Account","Links Contact to Household Account","HH_HouseholdNaming generates name and greetings","Address management syncs household address"],docs:["The Household Account model is the default account model for Nonprofit Success Pack and the model Salesforce strongly recommends. In this model, people (Contact records) are grouped together into households (Account records), and donations (Opportunity records) are associated with people and households.","When you create a new Contact with the Account Name field left blank, NPSP automatically creates a new Household Account for that Contact. The Household Account name is derived from the Contact name according to the Household Name Settings. NPSP automatically connects every constituent Contact record to a Household Account.","The Household Account model supports sophisticated features including Contact management for Household members, address management, automated household member soft credits, and organization Accounts for businesses and other entities.","The Account Model is configured in NPSP Settings. When changing the model, only new Accounts going forward are affected. Existing Accounts created with a different model must be manually updated."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_what_is_an_account_model.htm&language=en_US&type=5"},
    {id:"hh-naming",name:"Household Naming",icon:"\u{1F4DD}",desc:"HH_HouseholdNaming constructs names, formal greetings, and informal greetings from household members. Configurable via Household_Naming_Settings__c. HH_HouseholdNaming_BATCH handles bulk recalculation.",tags:["HH_HouseholdNaming","HH_HouseholdNaming_BATCH","Household_Naming_Settings__c"],triggerTags:["after insert","after update"],code:{title:"HH_HouseholdNaming.cls",lang:"Apex",body:'<span class="cm">// Household naming logic</span>\n<span class="kw">public class</span> <span class="ty">HH_HouseholdNaming</span> {\n\n  <span class="kw">public static</span> <span class="ty">String</span> <span class="fn">getHouseholdName</span>(\n    <span class="ty">List&lt;Contact&gt;</span> members\n  ) {\n    <span class="ty">List&lt;String&gt;</span> lastNames = <span class="kw">new</span> <span class="ty">List&lt;String&gt;</span>();\n    <span class="kw">for</span> (<span class="ty">Contact</span> c : members) {\n      <span class="kw">if</span> (!lastNames.contains(c.LastName))\n        lastNames.add(c.LastName);\n    }\n    <span class="cm">// "Smith Household" or "Smith & Jones Household"</span>\n    <span class="kw">return</span> <span class="ty">String</span>.join(lastNames, <span class="st">\' & \'</span>)\n      + <span class="st">\' Household\'</span>;\n  }\n}'},executionFlow:["Contact created/updated with household fields","HH_Households_TDTM fires (AfterInsert/AfterUpdate)","Queries all members of the household Account","HH_HouseholdNaming constructs name from members","Sets Account.Name, Formal_Greeting__c, Informal_Greeting__c"],docs:["When a new Contact is created, NPSP automatically derives the Household Account name from the Contact name according to the specifications in Household Name Settings. These settings also control the Formal Greeting and Informal Greeting fields on the Household Account.","When you mark a Contact as deceased, NPSP removes the deceased Contact from the Household Account Name, Formal Greeting, and Informal Greeting fields. Similarly, Contacts excluded from naming do not appear in the Household naming fields.","Household Name Settings are configured in NPSP Settings under People, Households, where administrators can customize the naming format for Household Account Name, Formal Greeting, and Informal Greeting."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_manage_constituents.htm&language=en_US&type=5"},
    {id:"contact-merge",name:"Contact Merge",icon:"\u{1F500}",desc:"CON_ContactMerge_TDTM preserves relationships, affiliations, and address records during contact merge. Also handles Do Not Contact automation via CON_DoNotContact_TDTM.",tags:["CON_ContactMerge_TDTM","CON_DoNotContact_TDTM"],triggerTags:["after update","after delete"],docs:["NPSP Contact Merge lets you merge duplicate Contacts into a single record. You choose which Contact to keep and what data to preserve from each duplicate. Unlike standard Salesforce merge, NPSP Contact Merge also merges Accounts in certain circumstances, such as when a merge leaves an Account with no Contacts.","When Contacts are merged, NPSP updates the Account Name, Formal and Informal Greeting fields, reparents Opportunities to the Account of the merged Contact, recalculates Household Soft Credits and Opportunity rollups, and deletes duplicate Affiliations and Relationships.","Merging Contacts is irreversible and requires Create, Edit, and Delete permissions on the Contact object. Access the Contact Merge feature from the Contact Merge tab, where you can search by Contact name or view duplicate record sets identified by Matching Rules."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_merge_contacts.htm&language=en_US&type=5"},
    {id:"acct-merge",name:"Account Merge",icon:"\u{1F3E2}",desc:"ACCT_AccountMerge_TDTM and ACCT_Accounts_TDTM handle post-merge cleanup for Accounts, reassigning child records and recalculating rollups.",tags:["ACCT_AccountMerge_TDTM","ACCT_Accounts_TDTM"],triggerTags:["after update","after delete"],docs:["When Accounts are merged in NPSP, the ACCT_AccountMerge_TDTM class handles data management during the merge process. It updates the Account Name, Formal and Informal Greeting fields, recalculates Household Soft Credits and Opportunity rollups, and deletes duplicate Addresses while propagating the Default Address.","NPSP provides a Manage Household interface for merging two different Household Accounts into one, or splitting one Household into different Accounts. Use Merge Households to combine two different Contacts into a single Household Account. If you have duplicate Contacts instead, use Contact Merge."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_merge_or_split_households.htm&language=en_US&type=5"}
  ],
  dataFlow:["Contact","Household Account","Address__c","Relationship__c","Affiliation__c"],
  connections:[{planet:"donations",desc:"Contacts/Accounts are the donors on Opportunities"},{planet:"rollups",desc:"Giving totals roll up to Contact and Account records"},{planet:"relationships",desc:"Contact-to-contact relationships tracked"},{planet:"affiliations",desc:"Contact-to-organization links"},{planet:"addresses",desc:"Household addresses shared by all members"},{planet:"recurring",desc:"Donor Contacts linked to Recurring Donations"},{planet:"softcredits",desc:"Soft credits attributed to Contact records"},{planet:"tdtm",desc:"Contact trigger dispatches TDTM handlers"},{planet:"engagement",desc:"Engagement plans assigned to Contacts"},{planet:"bdi",desc:"BDI creates and matches Contacts and Accounts"},{planet:"levels",desc:"Donor levels assigned to Contacts and Accounts"}]
},

recurring: {
  name: "Recurring Donations (RD2)",
  icon: "\u{1F504}",
  color: "#22c55e",
  description: "Enhanced Recurring Donations v2 is one of NPSP's most complex subsystems with 89 Apex classes. Manages scheduled recurring gifts with configurable frequencies, pause/resume, status automation, change logging, and Elevate payment integration. Auto-generates Opportunity records on schedule via RD2_OpportunityService. Legacy RD_ classes (13) remain for backward compatibility.",
  components: [
    {id:"rd2-engine",name:"RD2 Installment Engine",icon:"\u{1F4C5}",desc:"RD2_ScheduleService manages installment schedules and date calculations. RD2_OpportunityService creates/updates Opportunities. RD2_OpportunityMatcher matches existing Opportunities to installments to avoid duplicates.",tags:["RD2_RecurringDonations_TDTM","RD2_ScheduleService","RD2_OpportunityService"],triggerTags:["after insert","after update"],code:{title:"RD2_RecurringDonations_TDTM.cls",lang:"Apex",body:'<span class="cm">// Enhanced RD handler with service injection</span>\n<span class="kw">public class</span> <span class="ty">RD2_RecurringDonations_TDTM</span>\n  <span class="kw">extends</span> <span class="ty">TDTM_Runnable</span> {\n\n  <span class="kw">private</span> <span class="ty">DmlWrapper</span> dmlActions =\n    <span class="kw">new</span> <span class="ty">DmlWrapper</span>();\n\n  <span class="an">@TestVisible</span>\n  <span class="kw">private</span> <span class="ty">RD2_ScheduleService</span> scheduleService {\n    <span class="kw">get</span> {\n      <span class="kw">if</span> (scheduleService == <span class="kw">null</span>) {\n        scheduleService =\n          <span class="kw">new</span> <span class="ty">RD2_ScheduleService</span>();\n      }\n      <span class="kw">return</span> scheduleService;\n    }\n    <span class="kw">set</span>;\n  }\n\n  <span class="kw">public override</span> <span class="ty">DmlWrapper</span> <span class="fn">run</span>(...) {\n    <span class="cm">// Validates, builds schedules,</span>\n    <span class="cm">// evaluates opportunities</span>\n  }\n}'},executionFlow:["Recurring Donation created or modified","TDTM fires RD2_RecurringDonations_TDTM (after)","RD2_ScheduleService calculates next installment dates","RD2_OpportunityService creates Opportunity records","RD2_OpportunityMatcher checks for existing matches","Links each Opportunity back to the RD record"],docs:["Recurring Donations allows you to track gifts that donors have pledged over a period of time, including monthly, quarterly, yearly, and custom installment schedules. The feature accommodates both Open-Ended (no end date) and Fixed-Length (end date set) Recurring Donations.","Recurring Donations primarily uses the Recurring Donation custom object to set the donor, schedule, and amount, and the standard Opportunity object to track each individual installment. The Installment Opportunity Auto-Creation setting specifies when NPSP creates installment Opportunities.","For continuous installment generation, Recurring Donation owners must be active users, as these owners also own related Opportunities. NPSP stops generating new Opportunity installments if the owner becomes inactive.","Recurring Donation settings are configured in NPSP Settings under Recurring Donations, where you can set batch size, installment creation behavior, the Opportunity record type for installments, and the naming format."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_recurring_donations.htm&language=en_US&type=5"},
    {id:"rd2-status",name:"Status Automation",icon:"\u{1F6A6}",desc:"RD2_StatusAutomationService tracks lifecycle: Active, Lapsed, Closed, Paused. Automatically transitions based on payment history and configurable grace periods. Status mapping via RecurringDonationStatusMapping__mdt.",tags:["RD2_StatusAutomationService","RecurringDonationStatusMapping__mdt"],triggerTags:["after update"],docs:["Recurring Donations support multiple statuses including Active, Lapsed, Closed, and Paused. The Open Opportunity Behavior on RD Close setting tells NPSP what to do with remaining open Opportunities when a Recurring Donation is closed: Delete Open Opportunities, Mark Open Opportunities as Closed Lost, or No Action.","Status Automation settings allow NPSP to automatically transition Recurring Donations between statuses based on configurable rules. Users must have access to the RD2_StatusAutomationSettings_CTRL and RD2_StatusMappingSettings_CTRL Apex classes to configure status automation."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_recurring_donations.htm&language=en_US&type=5"},
    {id:"rd2-schedule",name:"Schedule & Change Log",icon:"\u{1F5D3}",desc:"RecurringDonationSchedule__c stores schedule entries (pause periods, amount changes). RecurringDonationChangeLog__c tracks all modifications. LWC components: rd2EntryForm, rd2PauseForm, rd2ChangeLog, rdScheduleVisualizer.",tags:["RecurringDonationSchedule__c","RecurringDonationChangeLog__c"],triggerTags:["after insert"],docs:["Recurring Donations include Lightning record page components that provide details about upcoming installment Opportunities and schedule information. The Active Schedules component shows current schedule details, and the Installments component shows upcoming and past installment Opportunities.","When the Recurring Donation Change Log is enabled, NPSP creates a Change Log record each time amount, schedule, or campaign fields are updated. If you enable the Change Log, consider disabling field history tracking for Recurring Donations to avoid confusion.","Deploy the Recurring Donation Active Schedules, Installments, and Change Log Lightning components on your Recurring Donation record pages via Setup, Object Manager, Recurring Donation, Lightning Record Pages."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_recurring_donations.htm&language=en_US&type=5"},
    {id:"rd2-batch",name:"RD Evaluation Batch",icon:"\u{2699}\uFE0F",desc:"RD2_OpportunityEvaluation_BATCH processes all active RDs nightly, creating new installments and updating statuses. RD2_DataMigration_BATCH migrates from legacy to enhanced RDs.",tags:["RD2_OpportunityEvaluation_BATCH","RD2_DataMigration_BATCH"],triggerTags:["nightly batch"],docs:["NPSP processes Recurring Donations through a nightly batch job that evaluates schedules and creates or updates installment Opportunities. The Recurring Donation Batch Size setting controls how many records are processed at a time, with a default of 50.","The batch job uses the Use Fiscal Year for Recurring Donations setting to determine whether Recurring Donation value totals are calculated by fiscal year or calendar year. Only Standard Fiscal Year is supported; Custom Fiscal Year is not."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_recurring_donations.htm&language=en_US&type=5"},
    {id:"rd2-elevate",name:"Elevate Integration",icon:"\u{1F4B3}",desc:"RD2_ElevateIntegrationService handles recurring payment processing through Salesforce Elevate. Manages commitment requests, payment capture, and tokenized card storage.",tags:["RD2_ElevateIntegrationService","PS_CommitmentRequest"],triggerTags:["callout"],docs:["Salesforce.org Elevate is an app that accepts and processes donations online, and automatically sends donation data to NPSP. Recurring Donations integrate with Elevate for payment processing, including support for multi-currency transactions.","The RD2_RecurringDonations_TDTM and RD2_RecurringDonationsOpp_TDTM Apex classes implement automation for Enhanced Recurring Donations including Elevate integration and multi-currency support. Gift Entry batches can include Recurring Donations when the Allow Recurring Donations option is selected."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_recurring_donations.htm&language=en_US&type=5"}
  ],
  dataFlow:["Recurring_Donation__c","RD_Schedule__c","ChangeLog__c","Opportunity (auto)","Payment","Rollup"],
  connections:[{planet:"donations",desc:"RDs auto-create Opportunity records as installments"},{planet:"contacts",desc:"Each RD linked to a donor Contact/Account"},{planet:"rollups",desc:"Current/Next Year values roll up from installments"},{planet:"batch",desc:"RD2_OpportunityEvaluation_BATCH processes bulk updates"},{planet:"elevate",desc:"Elevate handles recurring payment processing"},{planet:"allocations",desc:"RD allocations propagate to generated Opportunities"},{planet:"tdtm",desc:"Recurring Donation trigger dispatches RD2 TDTM handlers"}]
},

rollups: {
  name: "Customizable Rollups (CRLP)",
  icon: "\u{1F4CA}",
  color: "#f59e0b",
  description: "NPSP's most architecturally sophisticated subsystem: 76 Apex classes. Replaces legacy hardcoded rollups (RLLP_) with a metadata-driven engine. Rollup definitions in Rollup__mdt, filtering via Filter_Group__mdt + Filter_Rule__mdt. Supports SUM, COUNT, AVG, FIRST, LAST, YEARS_DONATED, DONOR_STREAK. Operates in two modes: NonSkew (query summary records) for normal volumes and SkewMode (query detail records) for accounts with many children.",
  components: [
    {id:"crlp-processor",name:"CRLP Processor",icon:"\u{2699}\uFE0F",desc:"CRLP_RollupProcessor_SVC routes to correct handler by rollup type. Six specialized SVC classes: CRLP_RollupAccount_SVC, CRLP_RollupContact_SVC, CRLP_RollupSoftCredit_SVC, CRLP_RollupAccSoftCredit_SVC, CRLP_RollupGAU_SVC, CRLP_RollupRD_SVC.",tags:["CRLP_RollupProcessor_SVC","CRLP_Rollup_SVC","CRLP_Rollup_SEL"],triggerTags:["batch / trigger"],code:{title:"CRLP_RollupProcessor_SVC.cls",lang:"Apex",body:'<span class="cm">// Handler routing by rollup type</span>\n<span class="kw">public static</span> <span class="ty">Type</span> <span class="fn">getHandlerClassType</span>(\n    <span class="ty">CRLP_RollupProcessingOptions.RollupType</span>\n      rollupType) {\n  <span class="ty">Type</span> handlerClass;\n  <span class="kw">switch on</span> (rollupType) {\n    <span class="kw">when</span> ContactSoftCredit, AccountContactSoftCredit {\n      handlerClass = <span class="ty">CRLP_RollupSoftCredit_SVC</span>.class;\n    }\n    <span class="kw">when</span> AccountSoftCredit {\n      handlerClass = <span class="ty">CRLP_RollupAccSoftCredit_SVC</span>.class;\n    }\n    <span class="kw">when</span> AccountHardCredit {\n      handlerClass = <span class="ty">CRLP_RollupAccount_SVC</span>.class;\n    }\n    <span class="kw">when</span> ContactHardCredit {\n      handlerClass = <span class="ty">CRLP_RollupContact_SVC</span>.class;\n    }\n    <span class="kw">when</span> GAU {\n      handlerClass = <span class="ty">CRLP_RollupGAU_SVC</span>.class;\n    }\n    <span class="kw">when</span> RecurringDonations {\n      handlerClass = <span class="ty">CRLP_RollupRD_SVC</span>.class;\n    }\n  }\n  <span class="kw">return</span> handlerClass;\n}'},executionFlow:["Detail record (Opportunity/Payment) changes","CRLP_Rollup_TDTM fires, checks if CRLP is enabled","Loads Rollup__mdt definitions via CRLP_Rollup_SEL","Routes to correct SVC class by rollup type","Applies Filter_Group__mdt rules to exclude records","Calculates aggregate value per rollup definition","Updates target field on summary record"],docs:["The Customizable Rollups feature lets you create highly customized rollups that roll up data from Opportunities, Payments, or Soft Credits (including Partial Soft Credits). You can create custom donation rollup fields on Accounts, Contacts, General Accounting Units, or Recurring Donations.","Customizable Rollups support two types of operations: Aggregate Rollups (Sum, Average, Count) that summarize data from multiple records, and Single Result Operations (First, Last, Largest, Smallest, Best Year, Best Year Total, Years Donated, Donor Streak) that copy data from a specific record.","Each rollup defines a Target Object and Field, an Operation, a Timeframe (All Time, Days Back, or Years Ago), a Rollup Type that combines the source object with credit type, and an optional Filter Group that determines which records are included.","Configure Customizable Rollups in NPSP Settings under Donations, Customizable Rollups."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_config_custom_rllps.htm&language=en_US&type=5"},
    {id:"crlp-trigger",name:"Real-time Trigger",icon:"\u{26A1}\uFE0F",desc:"CRLP_Rollup_TDTM fires on Opportunity and Payment changes. Submits queueable jobs for async rollup processing. Guards against duplicate processing with alreadyQueuedForRollupJob Set. Falls back to legacy RLLP handlers when CRLP not enabled.",tags:["CRLP_Rollup_TDTM","RLLP_OppRollup_TDTM"],triggerTags:["after insert","after update","after delete"],code:{title:"CRLP_Rollup_TDTM.cls",lang:"Apex",body:'<span class="cm">// Real-time rollup trigger handler</span>\n<span class="kw">public class</span> <span class="ty">CRLP_Rollup_TDTM</span>\n  <span class="kw">extends</span> <span class="ty">TDTM_Runnable</span> {\n\n  <span class="kw">private static final</span> <span class="ty">Integer</span>\n    MAX_ALLOWED_QUEUED_JOBS = <span class="nu">5</span>;\n  <span class="kw">private static</span> <span class="ty">Set&lt;Id&gt;</span>\n    alreadyQueuedForRollupJob =\n      <span class="kw">new</span> <span class="ty">Set&lt;Id&gt;</span>();\n\n  <span class="kw">public override</span> <span class="ty">DmlWrapper</span> <span class="fn">run</span>(...) {\n    <span class="kw">if</span> (!<span class="ty">CRLP_Rollup_SVC</span>\n        .isCustomizableRollupEngineEnabled) {\n      <span class="kw">return null</span>;\n      <span class="cm">// Falls back to legacy RLLP handlers</span>\n    }\n    <span class="cm">// Submits queueable for async processing</span>\n  }\n}'},executionFlow:["Opportunity or Payment changes","CRLP_Rollup_TDTM checks if CRLP enabled","If disabled, falls back to legacy RLLP handlers","Identifies affected parent IDs","Checks alreadyQueuedForRollupJob to prevent dupes","Submits Queueable job for async rollup"],docs:["When Customizable Rollups are enabled, the CRLP_Rollup_TDTM class implements real-time hard credit rollups. When you insert, update, delete, or undelete an Opportunity or Payment, the class determines if rollups to the parent Account, Contact, and/or General Accounting Unit are necessary.","The trigger handler runs on both the Opportunity and OppPayment (Payment) objects. For Opportunities, it evaluates hard credit rollups to Accounts, Contacts, and GAUs. For Payments, it performs the same evaluation against the Payment's parent Opportunity hierarchy."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_config_custom_rllps.htm&language=en_US&type=5"},
    {id:"crlp-batch",name:"Batch Rollup Jobs",icon:"\u{1F3ED}",desc:"14 batch classes extending CRLP_Batch_Base. NonSkew mode: CRLP_Account_BATCH, CRLP_Contact_BATCH, CRLP_GAU_BATCH, CRLP_RD_BATCH plus soft credit variants. SkewMode: CRLP_AccountSkew_BATCH, CRLP_ContactSkew_BATCH for accounts with many Opportunities. CRLP_SkewDispatcher_BATCH orchestrates skew processing.",tags:["CRLP_Batch_Base","CRLP_Account_BATCH","CRLP_SkewDispatcher_BATCH"],triggerTags:["scheduled batch"],docs:["Customizable Rollups are calculated by a series of nightly batch jobs that run in one of three modes: Non-Skew Mode (default, most efficient for normal data volumes), Skew Mode (processes records with more than 250 related records separately), or Incremental Mode (only evaluates records with recently modified Opportunities).","There are 13 batch jobs scheduled to start at 11 PM by default, covering Account Hard Credit, Contact Hard Credit, Account-level Contact Soft Credit, Account Soft Credit, Contact Soft Credit, General Accounting Units, and Recurring Donations. Each category has both a Non-Skew and Skew mode variant.","Batch job sizes can be configured in NPSP Settings under Bulk Data Processes. If jobs time out or take more than 24 hours, NPSP automatically switches to Incremental Mode for Contact Hard Credit and Account Hard Credit Non-Skew jobs."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_config_custom_rllps.htm&language=en_US&type=5"},
    {id:"crlp-cmdt",name:"Rollup Configuration (CMDT)",icon:"\u{1F4DD}",desc:"Rollup__mdt defines each rollup: Summary_Object__c, Summary_Field__c, Detail_Object__c, Detail_Field__c, Operation__c, Filter_Group__c, Use_Fiscal_Year__c, Time_Bound_Operation_Type__c. Filter_Group__mdt + Filter_Rule__mdt for criteria. Ships with ~50 default definitions. Customizable_Rollup_Settings__c controls batch sizes and skew thresholds.",tags:["Rollup__mdt","Filter_Group__mdt","Filter_Rule__mdt","Customizable_Rollup_Settings__c"],triggerTags:["config"],docs:["Customizable Rollups store their configuration in Custom Metadata Types (CMDT), including rollup definitions and filter groups with filter rules. When you enable Customizable Rollups, NPSP converts all existing User Defined Rollups and the 87 out-of-box rollups into CMDT-based Customizable Rollups.","Filter Groups work like report filters, containing filter rules that use AND criteria to determine which records are included in a rollup. Filter rules can reference Account Soft Credit, Contact Soft Credit, GAU Allocation, Opportunity, and Payment objects.","Rollup configurations created in a Sandbox can be moved to Production by deploying the Custom Metadata Types that define them. Resetting Customizable Rollups removes all custom rollups, filter groups, and filter rules and restores defaults."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_config_custom_rllps.htm&language=en_US&type=5"}
  ],
  dataFlow:["Rollup__mdt (def)","Filter_Group__mdt","Detail Records","Calculate","Update Summary"],
  connections:[{planet:"donations",desc:"Donation changes are the primary rollup trigger"},{planet:"contacts",desc:"Rollup results written to Contact and Account"},{planet:"allocations",desc:"GAU allocation amounts roll up"},{planet:"batch",desc:"Full recalculation runs as batch Apex"},{planet:"softcredits",desc:"Separate rollup types for soft vs hard credits"},{planet:"recurring",desc:"RD rollup summaries"},{planet:"levels",desc:"Rollup fields used as level assignment criteria"},{planet:"settings",desc:"Rollup definitions configured through Settings UI"}]
},

softcredits: {
  name: "Soft Credits",
  icon: "\u{1F91D}",
  color: "#ec4899",
  description: "Attributes donations to contacts beyond the primary donor. Standard OCR-based soft credits via OpportunityContactRole, plus custom Partial Soft Credits (Partial_Soft_Credit__c) for splitting amounts. Account Soft Credits (Account_Soft_Credit__c) roll up at org level. Separate CRLP rollup types for soft vs hard credits.",
  components: [
    {id:"ocr-softcredit",name:"OCR Soft Credits",icon:"\u{1F465}",desc:"Uses standard OpportunityContactRole records. Any contact with a role on the Opportunity gets soft credit. OPP_OpportunityContactRoles_TDTM and HH_OppContactRoles_TDTM auto-create OCRs for household members.",tags:["OPP_OpportunityContactRoles_TDTM","HH_OppContactRoles_TDTM","OpportunityContactRole"],triggerTags:["after insert","after update"],code:{title:"Household OCR Creation",lang:"Apex",body:'<span class="cm">// Auto OCR creation for household members</span>\n<span class="kw">public class</span> <span class="ty">HH_OppContactRoles_TDTM</span>\n  <span class="kw">extends</span> <span class="ty">TDTM_Runnable</span> {\n\n  <span class="kw">public override</span> <span class="ty">DmlWrapper</span> <span class="fn">run</span>(...) {\n    <span class="ty">DmlWrapper</span> dml = <span class="kw">new</span> <span class="ty">DmlWrapper</span>();\n    <span class="kw">for</span> (<span class="ty">Opportunity</span> opp : opps) {\n      <span class="ty">List&lt;Contact&gt;</span> hhMembers =\n        <span class="fn">getHouseholdMembers</span>(opp.AccountId);\n      <span class="kw">for</span> (<span class="ty">Contact</span> member : hhMembers) {\n        <span class="kw">if</span> (member.Id != opp.ContactId) {\n          dml.objectsToInsert.add(\n            <span class="kw">new</span> <span class="ty">OpportunityContactRole</span>(\n              OpportunityId = opp.Id,\n              ContactId = member.Id,\n              Role = <span class="st">\'Household Member\'</span>\n          ));\n        }\n      }\n    }\n    <span class="kw">return</span> dml;\n  }\n}'},executionFlow:["Donation created with primary Contact","TDTM fires HH_OppContactRoles_TDTM","Queries household members from same Account","Creates OpportunityContactRole for each member","Soft credit rollups update on each credited Contact"],docs:["Soft credits are a fundraising concept that represent recognition of credit for donations. Most soft credits use an Opportunity Contact Role (OCR), which connects a Contact to an Opportunity and defines their role. NPSP includes twelve out-of-box OCR values such as Donor, Household Member, Soft Credit, and Matched Donor.","NPSP creates automated soft credits in several scenarios: Household Member soft credits for all members when any member donates, Matching Gift soft credits for matched donors, Relationship-based soft credits, Affiliation-based soft credits for organizational donations, and Primary Contact soft credits on organizational gifts.","NPSP aggregates soft credit totals using rollup fields found in the Soft Credit Total section of a Contact record. These rollups are calculated in the nightly batch, so changes are not reflected immediately unless an administrator manually recalculates."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Config_Soft_Credits.htm&language=en_US&type=5"},
    {id:"partial-softcredit",name:"Partial Soft Credits",icon:"\u{2702}\uFE0F",desc:"Partial_Soft_Credit__c allows splitting soft credit amounts. PSC_PartialSoftCredit_TDTM validates on BeforeInsert/BeforeUpdate. PSC_Opportunity_TDTM manages Account_Soft_Credit__c records on Opportunity changes.",tags:["PSC_PartialSoftCredit_TDTM","PSC_Opportunity_TDTM","Partial_Soft_Credit__c","Account_Soft_Credit__c"],triggerTags:["before insert","after update"],docs:["A Partial Soft Credit is a soft credit for an amount that is only a portion of the larger donation. This is useful when organizations collect aggregate donations and distribute them to nonprofits, where the nonprofit creates a single Opportunity for the larger check but needs to credit individual constituents for their specific amounts.","Partial Soft Credits use the Partial_Soft_Credit__c custom object. Every Partial Soft Credit record should have a corresponding Opportunity Contact Role record, but not every Contact Role will have a Partial Soft Credit. Partial Soft Credits are also automatically created when matching employee donations with employer matching gifts.","To enable Partial Soft Credits, grant the same object-level permissions as Opportunities to all relevant profiles. Users also need access to the PSC_ManageSoftCredits Visualforce page, and the Manage Soft Credits button should be added to Opportunity page layouts."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Config_Soft_Credits.htm&language=en_US&type=5"}
  ],
  dataFlow:["Opportunity","OpportunityContactRole","Partial_Soft_Credit__c","Account_Soft_Credit__c","Rollup"],
  connections:[{planet:"donations",desc:"Soft credits attached to Opportunities"},{planet:"contacts",desc:"Credits attributed to Contact records"},{planet:"rollups",desc:"Separate CRLP rollup types for soft credits"},{planet:"giftentry",desc:"Gift Entry provides soft credit widget in forms"}]
},

allocations: {
  name: "Allocations & Fund Accounting",
  icon: "\u{1F4C2}",
  color: "#06b6d4",
  description: "Distributes donation amounts across General Accounting Units (GAUs). 28 ALLO_ classes. Supports percentage-based or fixed-amount splits. Enforces no over-allocation. Allocation changes propagate between Opportunities and Payments, and from Recurring Donations to child Opportunities. ALLO_Multicurrency_TDTM handles currency adjustments.",
  components: [
    {id:"gau",name:"General Accounting Units",icon:"\u{1F3E6}",desc:"General_Accounting_Unit__c represents a fund, program, or accounting category. GAU_TDTM prevents deletion of GAUs with child allocations. Accumulates rollup totals via CRLP_GAU_BATCH.",tags:["General_Accounting_Unit__c","GAU_TDTM","CRLP_GAU_BATCH"],triggerTags:["rollup target"],docs:["General Accounting Units (GAUs) allow nonprofits to designate donations or portions of donations to specific funds or programs. GAUs often map to an organization's chart of accounts or accounting classes.","NPSP allows you to define as many GAUs as needed. You can allocate donations to a GAU as a percentage of the donation amount or as a specific dollar amount. Many nonprofits offer fund designation choices on their online donation pages so donors can direct support to program areas that matter most.","GAUs are created from the General Accounting Units tab in NPSP. A Default GAU can be enabled in NPSP Settings under Donations, GAU Allocations so that all new Opportunities are automatically allocated to a default fund."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_config_donation_allocs.htm&language=en_US&type=5"},
    {id:"alloc-engine",name:"Allocation Engine",icon:"\u{1F4B1}",desc:"ALLO_Allocations_TDTM manages creation and enforcement on Allocation__c, Payment, and Opportunity objects. Supports default allocations (remainder goes to default GAU), percentage splits, and total validation.",tags:["ALLO_Allocations_TDTM","ALLO_PaymentSync_TDTM","Allocation__c","Allocations_Settings__c"],triggerTags:["after insert","after update"],code:{title:"ALLO_Allocations_TDTM.cls",lang:"Apex",body:'<span class="cm">// Allocation handler with settings facade</span>\n<span class="kw">public class</span> <span class="ty">ALLO_Allocations_TDTM</span>\n  <span class="kw">extends</span> <span class="ty">TDTM_Runnable</span> {\n\n  <span class="kw">public</span> <span class="ty">Map&lt;Id, alloWrapper&gt;</span> mapWrapper =\n    <span class="kw">new</span> <span class="ty">Map&lt;Id, alloWrapper&gt;</span>();\n\n  <span class="kw">public static</span> <span class="ty">Allocations_Settings__c</span> settings =\n    <span class="ty">UTIL_CustomSettingsFacade</span>\n      .<span class="fn">getAllocationsSettings</span>();\n\n  <span class="kw">public override</span> <span class="ty">DmlWrapper</span> <span class="fn">run</span>(...) {\n    <span class="cm">// Enforces allocation totals</span>\n    <span class="cm">// Calculates percentages</span>\n    <span class="cm">// Syncs between Opp and Payment allocs</span>\n  }\n}'},executionFlow:["Donation created or amount changed","ALLO_Allocations_TDTM fires (after)","Calculates total allocated vs Opportunity Amount","If under-allocated and default GAU set, creates allocation","ALLO_PaymentSync_TDTM syncs Payment allocations","GAU rollups recalculate via CRLP"],docs:["The ALLO_Allocations_TDTM class manages GAU Allocations on Opportunities. It prevents Allocations from exceeding the parent Opportunity Amount, calculates amounts for percentage-based Allocations, and creates GAU Allocations by copying from a related Campaign or Recurring Donation when Opportunities are created.","NPSP uses a precedence order when Allocations are defined in multiple places: manually created Allocations take highest priority, followed by NPSP Data Import records, Recurring Donation Allocations, Campaign Allocations, and finally the Default GAU.","GAU Allocations include a series of rollups that aggregate allocation data on General Accounting Unit records from Closed Won Opportunities. Configure allocation settings in NPSP Settings under Donations, GAU Allocations."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_config_donation_allocs.htm&language=en_US&type=5"},
    {id:"alloc-multi",name:"Multicurrency Support",icon:"\u{1F4B1}",desc:"ALLO_Multicurrency_TDTM handles currency adjustments on Campaign and Recurring Donation objects. ALLO_MakeDefaultAllocations_BATCH creates default GAU allocations for existing records.",tags:["ALLO_Multicurrency_TDTM","ALLO_MakeDefaultAllocations_BATCH"],triggerTags:["after update","batch"],docs:["The GAU Allocations feature supports multiple currencies. Allocations inherit the currency of the parent Opportunity, Campaign, or Recurring Donation. Changing the currency on a parent record automatically updates each related Allocation's currency.","The ALLO_Multicurrency_TDTM class fires when you update the CurrencyIsoCode on a Campaign or Recurring Donation, updating all related child GAU Allocations to the same currency value. This class only applies to orgs using Multiple Currencies and does not support Advanced Currency Management."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_config_donation_allocs.htm&language=en_US&type=5"}
  ],
  dataFlow:["Opportunity/Payment","Allocation__c","General_Accounting_Unit__c","Rollup to GAU"],
  connections:[{planet:"donations",desc:"Allocations split donation amounts across funds"},{planet:"rollups",desc:"GAU totals maintained by CRLP_GAU_BATCH"},{planet:"recurring",desc:"RD allocations propagate to generated Opportunities"},{planet:"bdi",desc:"BDI creates allocations during data import"},{planet:"giftentry",desc:"Gift Entry provides allocation widget in forms"}]
},

tdtm: {
  name: "TDTM Framework",
  icon: "\u{26A1}\uFE0F",
  color: "#ef4444",
  description: "Table-Driven Trigger Management is NPSP's architectural foundation. ONE trigger per object dispatches to handler classes registered in Trigger_Handler__c custom SETTING (not CMDT). Two base classes: TDTM_Runnable (standard) and TDTM_RunnableMutable (for handlers needing record mutation). TDTM_DefaultConfig ships ~50 handler registrations. Admins can enable/disable handlers, control Load_Order__c, run handlers asynchronously, and exclude by username.",
  components: [
    {id:"tdtm-dispatcher",name:"TDTM Dispatcher",icon:"\u{1F4E1}",desc:"TDTM_TriggerHandler is the central dispatcher. Each object has one trigger calling TDTM_Config_API.run(). Queries Trigger_Handler__c, sorts by Load_Order__c, instantiates via Type.forName(), collects DmlWrapper results for batch DML.",tags:["TDTM_TriggerHandler","TDTM_Config_API","TDTM_TriggerActionHelper"],triggerTags:["all events"],code:{title:"TDTM Architecture (from actual source)",lang:"Apex",body:'<span class="cm">// 1. The Trigger (one per object)</span>\n<span class="kw">trigger</span> <span class="ty">TDTM_Contact</span> <span class="kw">on</span> <span class="ty">Contact</span> (\n  after delete, after insert, after undelete,\n  after update, before delete,\n  before insert, before update\n) {\n  <span class="ty">TDTM_Config_API</span>.<span class="fn">run</span>(\n    Trigger.isBefore, Trigger.isAfter,\n    Trigger.isInsert, Trigger.isUpdate,\n    Trigger.isDelete, Trigger.isUnDelete,\n    Trigger.new, Trigger.old,\n    Schema.Sobjecttype.Contact\n  );\n}\n\n<span class="cm">// 2. Abstract Base Classes</span>\n<span class="kw">global abstract class</span> <span class="ty">TDTM_Runnable</span> {\n  <span class="kw">global abstract</span> <span class="ty">DmlWrapper</span> <span class="fn">run</span>(\n    <span class="ty">List&lt;SObject&gt;</span> newlist,\n    <span class="ty">List&lt;SObject&gt;</span> oldlist,\n    <span class="ty">Action</span> triggerAction,\n    <span class="ty">Schema.DescribeSObjectResult</span> objResult\n  );\n  <span class="kw">global class</span> <span class="ty">DmlWrapper</span> {\n    <span class="kw">global</span> <span class="ty">List&lt;SObject&gt;</span> objectsToInsert;\n    <span class="kw">global</span> <span class="ty">List&lt;SObject&gt;</span> objectsToUpdate;\n    <span class="kw">global</span> <span class="ty">List&lt;SObject&gt;</span> objectsToDelete;\n    <span class="kw">global</span> <span class="ty">List&lt;SObject&gt;</span> objectsToUndelete;\n  }\n}\n\n<span class="cm">// TDTM_RunnableMutable: second base class</span>\n<span class="cm">// for handlers that need to mutate records</span>'},executionFlow:["DML operation fires the object's single trigger","Trigger calls TDTM_Config_API.run()","TDTM_TriggerHandler queries Trigger_Handler__c","Filters by Object__c, Active__c, Trigger_Action__c","Sorts by Load_Order__c","Instantiates each handler via Type.forName()","Calls handler.run() with trigger context","Collects DmlWrapper results for batch DML"],docs:["Table-Driven Trigger Management (TDTM) is a framework for managing Apex triggers in NPSP. NPSP uses one trigger per object, and the TDTM_TriggerHandler class dispatches execution to the appropriate Apex classes based on Trigger Handler records.","The actual business logic is stored in plain Apex classes that extend TDTM_Runnable. The Trigger Handler queries Trigger_Handler__c records to determine which classes should run for each object and action, in what order, and whether they are active. All DML operations are batched through the DmlWrapper class.","TDTM lets you disable specific pieces of code, build your own custom code that works within the NPSP framework, and control the execution order of Apex classes. To extend TDTM, create a class that extends npsp.TDTM_Runnable and create a corresponding Trigger Handler record."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.tdtm_advanced_configuration_overview.htm&language=en_US&type=5"},
    {id:"tdtm-metadata",name:"Handler Registration",icon:"\u{1F4CB}",desc:"Trigger_Handler__c custom SETTING fields: Class__c, Object__c, Trigger_Action__c, Load_Order__c, Active__c, Asynchronous__c, User_Managed__c, Usernames_to_Exclude__c. TDTM_DefaultConfig defines ~50 default registrations. User_Managed__c prevents NPSP from overwriting customer handlers.",tags:["Trigger_Handler__c","TDTM_DefaultConfig","TDTM_ObjectDataGateway"],triggerTags:["configuration"],code:{title:"Handler Registration Fields",lang:"Apex",body:'<span class="cm">// Trigger_Handler__c (Custom SETTING, not CMDT)</span>\n<span class="cm">// Fields:</span>\nActive__c:        <span class="ty">Boolean</span>  <span class="cm">// enable/disable</span>\nAsynchronous__c:  <span class="ty">Boolean</span>  <span class="cm">// run as @future</span>\nClass__c:         <span class="ty">Text</span>     <span class="cm">// Apex class name</span>\nLoad_Order__c:    <span class="ty">Number</span>   <span class="cm">// execution order</span>\nObject__c:        <span class="ty">Text</span>     <span class="cm">// SObject API name</span>\nTrigger_Action__c: <span class="ty">Text</span>    <span class="cm">// "BeforeInsert;AfterUpdate"</span>\nUser_Managed__c:  <span class="ty">Boolean</span>  <span class="cm">// prevent NPSP overwrite</span>\nUsernames_to_Exclude__c: <span class="ty">Text</span> <span class="cm">// skip for users</span>\n\n<span class="cm">// Example from TDTM_DefaultConfig:</span>\nhandlers.add(<span class="kw">new</span> <span class="ty">Trigger_Handler__c</span>(\n  Active__c = <span class="kw">true</span>,\n  Class__c = <span class="st">\'PMT_Payment_TDTM\'</span>,\n  Object__c = <span class="st">\'Opportunity\'</span>,\n  Load_Order__c = <span class="nu">2</span>,\n  Trigger_Action__c =\n    <span class="st">\'AfterInsert;AfterUpdate\'</span>\n));'},executionFlow:["Admin opens NPSP Settings > TDTM page","Views all registered Trigger_Handler__c records","Can toggle Active__c to disable a handler","Can change Load_Order__c to reorder execution","Can add custom handler classes","User_Managed__c prevents NPSP overwrites"],docs:["Trigger Handler records are a fundamental part of TDTM. The Trigger_Handler__c object manages trigger behavior through fields including Active (whether the class runs), Class (the Apex class name), Object (the Salesforce object), Trigger Action (BeforeInsert, AfterUpdate, etc.), and Load Order (execution sequence).","Additional fields include User Managed (prevents reactivation during package updates when a handler is disabled) and Usernames to Exclude (disables the handler for specific users, useful for integrations or data imports).","Manage Trigger Handlers from the Trigger Handlers tab or NPSP Settings, System Tools, Trigger Configuration. Load Order is important: if you want custom code to fire after NPSP packaged code, choose a number after the last number used for that object."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.tdtm_advanced_configuration_overview.htm&language=en_US&type=5"},
    {id:"tdtm-recursion",name:"Recursion Guard",icon:"\u{1F6E1}",desc:"DmlWrapper collects all DML from handlers and executes in a single batch after all handlers run. TDTM_ProcessControl tracks which handlers have fired to prevent recursion. Ensures consistent state across the handler chain.",tags:["TDTM_ProcessControl","DmlWrapper"],triggerTags:["framework"]}
  ],
  dataFlow:["DML Event","Single Trigger","TDTM_Config_API","Query Handlers","Execute in Order","Collect DML","Batch Execute"],
  connections:[{planet:"donations",desc:"Opportunity trigger dispatches ~10 handlers"},{planet:"contacts",desc:"Contact trigger dispatches account, address, relationship handlers"},{planet:"recurring",desc:"Recurring Donation trigger dispatches RD2 handlers"},{planet:"settings",desc:"Handler config in Trigger_Handler__c custom setting"},{planet:"errors",desc:"Errors caught from TDTM handler chain"}]
},

batch: {
  name: "Batch Processing",
  icon: "\u{2699}\uFE0F",
  color: "#8b5cf6",
  description: "45 batch Apex classes handle async processing exceeding governor limits. Batch jobs cover: rollup recalculation (14 CRLP batches), recurring donation evaluation, data import/migration, household naming, level assignment, error processing, and address verification. Most run nightly or can be triggered from NPSP Settings.",
  components: [
    {id:"rollup-batches",name:"CRLP Batch Jobs",icon:"\u{1F4CA}",desc:"14 batch classes: CRLP_Account_BATCH, CRLP_Contact_BATCH, CRLP_GAU_BATCH, CRLP_RD_BATCH, plus soft credit and skew mode variants. All extend CRLP_Batch_Base. CRLP_SkewDispatcher_BATCH orchestrates skew processing for high-volume accounts.",tags:["CRLP_Batch_Base","CRLP_Account_BATCH","CRLP_Contact_BATCH","CRLP_SkewDispatcher_BATCH"],triggerTags:["scheduled"],code:{title:"CRLP Batch Pattern",lang:"Apex",body:'<span class="cm">// All CRLP batches extend CRLP_Batch_Base</span>\n<span class="kw">public class</span> <span class="ty">CRLP_Account_BATCH</span>\n  <span class="kw">extends</span> <span class="ty">CRLP_Batch_Base</span>\n  <span class="kw">implements</span> <span class="ty">Database.Batchable&lt;SObject&gt;</span>,\n             <span class="ty">Database.Stateful</span> {\n\n  <span class="kw">public</span> <span class="ty">Database.QueryLocator</span> <span class="fn">start</span>(\n    <span class="ty">Database.BatchableContext</span> bc\n  ) {\n    <span class="kw">return</span> <span class="ty">Database</span>.getQueryLocator(\n      <span class="st">\'SELECT Id FROM Account \'</span> +\n      <span class="st">\'WHERE npe01__SYSTEM_AccountType__c \'</span>+\n      <span class="st">\'IN (\\\'Household\\\',\\\'Organization\\\')\'</span>\n    );\n  }\n\n  <span class="kw">public void</span> <span class="fn">execute</span>(\n    <span class="ty">Database.BatchableContext</span> bc,\n    <span class="ty">List&lt;Account&gt;</span> scope\n  ) {\n    <span class="ty">CRLP_RollupProcessor</span> processor =\n      <span class="kw">new</span> <span class="ty">CRLP_RollupProcessor</span>();\n    processor.<span class="fn">completeRollup</span>(scope);\n    <span class="kw">update</span> scope;\n  }\n}'},executionFlow:["Scheduled job or manual trigger initiates batch","start() queries all target records","execute() processes in batches of 200","CRLP_RollupProcessor calculates rollups","Updates summary records with new values","finish() chains dependent batches"],docs:["Customizable Rollups (CRLP) batch jobs recalculate donation summary fields on Account, Contact, and Recurring Donation records. The Rollup Donations Batch recalculates all hard credit and soft credit rollups, while the Rollup Allocations Batch recalculates allocation rollup data for all General Accounting Units.","NPSP schedules 14 CRLP batch classes that run nightly, including separate jobs for Account, Contact, GAU, and Recurring Donation rollups. Skew batch variants handle records with unusually high child counts so rollup jobs complete without hitting governor limits.","If a job takes too long, increase the batch size in increments of 25 or 50. If you hit governor limit errors, decrease the batch size. Batch sizes are configured in NPSP Settings under Bulk Data Processes."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_ongoing_administration.htm&language=en_US&type=5"},
    {id:"rd-batch",name:"RD Evaluation Batch",icon:"\u{1F504}",desc:"RD2_OpportunityEvaluation_BATCH processes all active Recurring Donations nightly. Creates new installments, updates statuses. RD2_DataMigration_BATCH migrates legacy to enhanced RDs.",tags:["RD2_OpportunityEvaluation_BATCH","RD2_DataMigration_BATCH"],triggerTags:["nightly"],docs:["The Recurring Donations Batch process runs every night to create any additional Opportunities needed for active Recurring Donations. For Enhanced Recurring Donations, the job uses RD2_OpportunityEvaluation_BATCH; for legacy Recurring Donations, it uses RD_RecurringDonations_BATCH.","This nightly evaluation determines which Recurring Donation records need new installment Opportunities created, based on the donation schedule, installment period, and effective dates. The batch also handles updates to existing installments when Recurring Donation settings change.","You can manually run the Recurring Donations Batch from NPSP Settings under Bulk Data Processes if you change your Recurring Donation settings and need immediate results."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_ongoing_administration.htm&language=en_US&type=5"},
    {id:"legacy-batches",name:"Legacy Rollup Batches",icon:"\u{1F4E6}",desc:"RLLP_OppAccRollup_BATCH, RLLP_OppContactRollup_BATCH, RLLP_OppHouseholdRollup_BATCH, RLLP_OppSoftCreditRollup_BATCH. Active when CRLP not enabled. 12 RLLP_ classes total.",tags:["RLLP_OppAccRollup_BATCH","RLLP_OppContactRollup_BATCH"],triggerTags:["legacy"],docs:["Legacy rollup batches (RLLP_ classes) are the original rollup calculation jobs used before Customizable Rollups were introduced. These include RLLP_OppAccRollup_BATCH for Account rollups, RLLP_OppContactRollup_BATCH for Contact rollups, RLLP_OppHouseholdRollup_BATCH for Household rollups, and RLLP_OppSoftCreditRollup_BATCH for soft credit rollups.","Legacy rollups work only on Opportunity Contact Roles, unlike Customizable Rollups which roll up data to the Contact selected in the Opportunity Primary Contact field even without a Contact Role present.","Legacy rollup batches remain active when Customizable Rollups are not enabled. If your org has migrated to CRLP, the legacy jobs are replaced by the CRLP_ batch classes."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_ongoing_administration.htm&language=en_US&type=5"},
    {id:"other-batches",name:"Utility Batches",icon:"\u{1F527}",desc:"HH_HouseholdNaming_BATCH recalculates names. LVL_LevelAssign_BATCH assigns donor tiers. ALLO_MakeDefaultAllocations_BATCH creates defaults. OPP_OpportunityNaming_BATCH renames. ADDR_Validator_BATCH verifies addresses.",tags:["HH_HouseholdNaming_BATCH","LVL_LevelAssign_BATCH","ADDR_Validator_BATCH"],triggerTags:["utility"],docs:["NPSP includes several utility batch jobs for housekeeping tasks: OPP_OpportunityNaming_BATCH refreshes Opportunity names, LVL_LevelAssign_SCHED recalculates Level assignments for Accounts and Contacts, and the Batch Create Default Allocations process creates GAU Allocations for existing Opportunities.","The Level Assignment Batch runs nightly to update Level values on records based on criteria such as total gifts or volunteer hours. You can also manually trigger it from NPSP Settings under Bulk Data Processes.","The Seasonal Address Updates batch runs once per night to set seasonal addresses as the current mailing address. Its default batch size is 10 and can be adjusted in NPSP Settings under Bulk Data Processes."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_ongoing_administration.htm&language=en_US&type=5"}
  ],
  dataFlow:["Scheduled Trigger","Batch start()","Query Scope","execute() chunks","Process & Update","finish() + chain"],
  connections:[{planet:"rollups",desc:"CRLP batch jobs are the bulk rollup mechanism"},{planet:"recurring",desc:"RD evaluation batch manages installment pipeline"},{planet:"settings",desc:"Batch sizes configured in NPSP Settings"},{planet:"levels",desc:"LVL_LevelAssign_BATCH assigns donor tiers"},{planet:"addresses",desc:"ADDR_Validator_BATCH for bulk address verification"},{planet:"errors",desc:"Batch job errors logged through ERR_Handler"}]
},

relationships: {
  name: "Relationships",
  icon: "\u{1F517}",
  color: "#f43f5e",
  description: "Tracks interpersonal relationships between Contacts (spouse, parent, employer, friend). 6 REL_ classes. Relationships are reciprocal: creating 'Father' from A to B auto-creates 'Son/Daughter' from B to A. REL_Relationships_Cm_TDTM auto-creates from CampaignMember co-membership. LWC: relationshipsNavigator, relationshipsTreeGrid.",
  components: [
    {id:"rel-reciprocal",name:"Reciprocal Relationships",icon:"\u{1F500}",desc:"REL_Relationships_TDTM fires on npe4__Relationship__c (AfterInsert/AfterUpdate/AfterDelete). Creates reciprocal relationship records automatically. Configurable relationship type mappings.",tags:["REL_Relationships_TDTM","npe4__Relationship__c"],triggerTags:["after insert","after update","after delete"],code:{title:"Reciprocal Relationship Pattern",lang:"Apex",body:'<span class="cm">// Three handlers for the Relationships domain:</span>\n\n<span class="cm">// 1. On Relationship object - creates reciprocals</span>\nhandlers.add(<span class="kw">new</span> <span class="ty">Trigger_Handler__c</span>(\n  Class__c = <span class="st">\'REL_Relationships_TDTM\'</span>,\n  Object__c = <span class="st">\'npe4__Relationship__c\'</span>,\n  Trigger_Action__c =\n    <span class="st">\'AfterInsert;AfterUpdate;AfterDelete\'</span>\n));\n\n<span class="cm">// 2. On Contact - syncs when contacts change</span>\nhandlers.add(<span class="kw">new</span> <span class="ty">Trigger_Handler__c</span>(\n  Class__c = <span class="st">\'REL_Relationships_Con_TDTM\'</span>,\n  Object__c = <span class="st">\'Contact\'</span>,\n  Trigger_Action__c =\n    <span class="st">\'AfterInsert;AfterUpdate;AfterDelete\'</span>\n));\n\n<span class="cm">// 3. On CampaignMember - auto-creates</span>\nhandlers.add(<span class="kw">new</span> <span class="ty">Trigger_Handler__c</span>(\n  Class__c = <span class="st">\'REL_Relationships_Cm_TDTM\'</span>,\n  Object__c = <span class="st">\'CampaignMember\'</span>,\n  Trigger_Action__c =\n    <span class="st">\'AfterInsert;AfterUpdate\'</span>\n));'},executionFlow:["User creates Relationship (A is Spouse of B)","REL_Relationships_TDTM fires (AfterInsert)","Looks up reciprocal type mapping","Creates reverse record (B is Spouse of A)","Both records linked via ReciprocalRelationship__c lookup"],docs:["Reciprocal Relationships automatically create a matching reverse relationship whenever you create a relationship between two Contacts. For example, creating a \"Son\" relationship from one Contact automatically creates a \"Father\" relationship on the other Contact's record.","NPSP supports two reciprocal methods: List Setting (the default) uses gender and predefined settings to determine the correct reciprocal type, while Value Inversion reverses a hyphenated type like \"Mother-Daughter\" to \"Daughter-Mother.\"","The Reciprocal Relationships list in NPSP Settings defines the male, female, and neutral reciprocal types for each relationship name. You can add new reciprocal pairs by first adding picklist values to the Relationship object's Type field, then creating the reciprocal entry in NPSP Settings under Relationships."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_manage_relationships_settings.htm&language=en_US&type=5"},
    {id:"rel-contact",name:"Contact Sync",icon:"\u{1F465}",desc:"REL_Relationships_Con_TDTM syncs relationships when Contacts change (AfterInsert/AfterUpdate/AfterDelete). Preserves relationships during contact merge via CON_ContactMerge_TDTM.",tags:["REL_Relationships_Con_TDTM","npe4__Relationship_Settings__c"],triggerTags:["after insert","after update","after delete"],docs:["When Custom Field Sync is enabled, NPSP automatically synchronizes Relationship fields between the two Contacts in a relationship pair. This ensures that when you update a custom field on one side of a reciprocal relationship, the change is reflected on the corresponding relationship record.","You can exclude specific Relationship fields from synchronization using the Fields to Exclude from Sync setting. This is useful when certain fields should remain independent between the two sides of a relationship.","Configure Custom Field Sync in NPSP Settings under Relationships. Select Enable Custom Field Sync to activate the feature, then optionally specify which fields to exclude from synchronization."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_manage_relationships_settings.htm&language=en_US&type=5"},
    {id:"rel-campaign",name:"Auto-Create from Campaigns",icon:"\u{1F4E3}",desc:"REL_Relationships_Cm_TDTM auto-creates relationships when Contacts are co-members of a Campaign. Configurable via Relationship_Auto_Create_Settings__c.",tags:["REL_Relationships_Cm_TDTM","CampaignMember"],triggerTags:["after insert","after update"],docs:["Auto-created Relationships allow a custom Contact lookup field on the Contact or Campaign Member objects to automatically trigger the creation of a new Relationship between two Contacts. For example, a \"Referred by\" lookup field on Campaign Member can establish a referral relationship when someone brings a new constituent to an event.","Before adding an auto-created relationship, an administrator must create a custom Contact lookup field on either Contact or Campaign Member, add the necessary picklist values to the Relationship Type field, and configure any new reciprocal relationship entries.","By default, NPSP prevents duplicate auto-created relationships of the same type between the same two Contacts. Configure auto-creation rules in NPSP Settings under Relationships Autocreation, specifying the object, field, relationship type, and applicable campaign types."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_manage_relationships_settings.htm&language=en_US&type=5"}
  ],
  dataFlow:["Contact A","Relationship__c","Reciprocal auto-created","Contact B"],
  connections:[{planet:"contacts",desc:"Relationships exist between Contacts and are preserved during merges"}]
},

addresses: {
  name: "Address Management",
  icon: "\u{1F4CD}",
  color: "#14b8a6",
  description: "Manages addresses as first-class objects (Address__c) linked to Accounts. 20 ADDR_ classes. Supports seasonal/mailing addresses, household sharing, and optional verification/normalization. When Address__c is updated, changes propagate to parent Account and all household Contact records. ADDR_Validator_TDTM supports async execution for external verification services.",
  components: [
    {id:"addr-core",name:"Address Object & Sync",icon:"\u{1F3E0}",desc:"ADDR_Addresses_TDTM is the main handler on Address__c (Before/AfterInsert, Before/AfterUpdate, AfterDelete). Copies address fields to Account and all household Contacts. Supports configurable async execution.",tags:["ADDR_Addresses_TDTM","Address__c"],triggerTags:["before insert","after insert","after update","after delete"],code:{title:"Address Handler (Async-Capable)",lang:"Apex",body:'<span class="cm">// Address handler supports async execution</span>\nhandlers.add(<span class="kw">new</span> <span class="ty">Trigger_Handler__c</span>(\n  Active__c = <span class="kw">true</span>,\n  <span class="cm">// Asynchronous__c is configurable!</span>\n  Asynchronous__c = <span class="kw">false</span>,\n  Class__c = <span class="st">\'ADDR_Addresses_TDTM\'</span>,\n  Load_Order__c = <span class="nu">1</span>,\n  Object__c = <span class="st">\'Address__c\'</span>,\n  Trigger_Action__c =\n    <span class="st">\'BeforeInsert;BeforeUpdate;\'</span>\n    + <span class="st">\'AfterInsert;AfterUpdate;AfterDelete\'</span>\n));'},executionFlow:["Address__c record created or modified","ADDR_Addresses_TDTM fires (before/after)","Identifies parent Account and household Contacts","Copies address fields to Account billing/shipping","Syncs address to all household member Contacts","Handles seasonal address logic"],docs:["NPSP Address Management allows you to record and maintain a history of different types of addresses for Accounts, such as home, work, and seasonal addresses. Each address is stored as a separate Address record, and one address is marked as the Default Address.","When an Address record marked as Default is modified, the change is automatically copied to the Household Account's Billing Address fields and all related Contacts' Mailing Address fields, except Contacts with Address Override enabled.","By default, Household Accounts have Address Management enabled and Organization Accounts do not. You can toggle these settings in NPSP Settings under People, Addresses. The Simple Address Change Treated as Update option controls whether minor corrections update the existing Address record or create a new one."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_addresses.htm&language=en_US&type=5"},
    {id:"addr-contact",name:"Contact Address Sync",icon:"\u{1F464}",desc:"ADDR_Contact_TDTM creates Address__c records from Contact address fields. ADDR_Account_TDTM creates from Account address fields. Bidirectional sync between Address__c and standard address fields.",tags:["ADDR_Contact_TDTM","ADDR_Account_TDTM"],triggerTags:["after insert","after update"],docs:["NPSP provides bidirectional synchronization between Contact mailing address fields and the Address object. When you modify a Contact's Mailing Address, NPSP creates a new Address record in the Household Account's Addresses related list and marks it as the Default Address.","If a Contact's Address Override checkbox is not checked, changes to the Contact's mailing address propagate to the Household Account's Billing Address and all other Contacts in the household. If Address Override is checked, only that individual Contact's mailing address fields are affected.","Contacts with Address Override can maintain a different mailing address from the rest of the household. When the Default Address is updated on the Account, it copies to all Contacts except those with Address Override enabled."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_addresses.htm&language=en_US&type=5"},
    {id:"addr-verify",name:"Address Verification",icon:"\u{2705}\uFE0F",desc:"ADDR_Validator_TDTM provides address verification/normalization through external services. Supports async execution. ADDR_Validator_BATCH for bulk verification. Settings in Addr_Verification_Settings__c.",tags:["ADDR_Validator_TDTM","ADDR_Validator_BATCH","Addr_Verification_Settings__c"],triggerTags:["after insert","after update"],docs:["NPSP lets you verify addresses as you enter them in Salesforce using one of three address verification APIs: SmartyStreets, Cicero, or Google Geocoding. Once configured, Salesforce checks whether addresses exist when you add them and standardizes formatting.","Address verification only works for records created after you set up the verification service and does not apply retroactively to previously entered addresses. Verification is also not performed on addresses imported using the NPSP Data Importer.","To configure verification, go to NPSP Settings under People, Addresses, enable Automatic Verification, and select your preferred API with the required credentials."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_configure_addresses.htm&language=en_US&type=5"}
  ],
  dataFlow:["Address__c","Account (billing/shipping)","Contact (mailing)","Verification Service"],
  connections:[{planet:"contacts",desc:"Addresses shared across household members"},{planet:"batch",desc:"ADDR_Validator_BATCH for bulk verification"}]
},

affiliations: {
  name: "Affiliations",
  icon: "\u{1F3E2}",
  color: "#6366f1",
  description: "Links Contacts to organizational Accounts (employer, board membership, volunteer role). Unlike Relationships (contact-to-contact), Affiliations are contact-to-organization. AFFL_Affiliations_TDTM is unique: the same class is registered on THREE different objects (Account, Contact, and Affiliation__c) with different load orders.",
  components: [
    {id:"affl-core",name:"Affiliation Engine",icon:"\u{1F517}",desc:"AFFL_Affiliations_TDTM fires on Account (AfterInsert/AfterUpdate, order 2), Contact (AfterInsert/AfterUpdate, order 1), and npe5__Affiliation__c (After*, order 1). Supports primary affiliation designation and status tracking.",tags:["AFFL_Affiliations_TDTM","npe5__Affiliation__c"],triggerTags:["after insert","after update","after delete"],code:{title:"AFFL on Three Objects",lang:"Apex",body:'<span class="cm">// Same class on THREE objects:</span>\n\n<span class="cm">// On Account (load order 2)</span>\nhandlers.add(<span class="kw">new</span> <span class="ty">Trigger_Handler__c</span>(\n  Class__c = <span class="st">\'AFFL_Affiliations_TDTM\'</span>,\n  Load_Order__c = <span class="nu">2</span>,\n  Object__c = <span class="st">\'Account\'</span>,\n  Trigger_Action__c =\n    <span class="st">\'AfterInsert;AfterUpdate\'</span>\n));\n\n<span class="cm">// On Contact (load order 1)</span>\nhandlers.add(<span class="kw">new</span> <span class="ty">Trigger_Handler__c</span>(\n  Class__c = <span class="st">\'AFFL_Affiliations_TDTM\'</span>,\n  Load_Order__c = <span class="nu">1</span>,\n  Object__c = <span class="st">\'Contact\'</span>,\n  Trigger_Action__c =\n    <span class="st">\'AfterInsert;AfterUpdate\'</span>\n));\n\n<span class="cm">// On Affiliation itself (load order 1)</span>\nhandlers.add(<span class="kw">new</span> <span class="ty">Trigger_Handler__c</span>(\n  Class__c = <span class="st">\'AFFL_Affiliations_TDTM\'</span>,\n  Load_Order__c = <span class="nu">1</span>,\n  Object__c = <span class="st">\'npe5__Affiliation__c\'</span>,\n  Trigger_Action__c =\n    <span class="st">\'AfterInsert;AfterUpdate;\'</span>\n    + <span class="st">\'AfterDelete;AfterUndelete\'</span>\n));'},executionFlow:["Contact associated with Organization Account","AFFL_Affiliations_TDTM fires on Contact (AfterInsert)","Creates npe5__Affiliation__c junction record","Sets primary affiliation if first for Contact","Status tracking: Current, Former, etc.","Role tracking: Employee, Board Member, Volunteer"],docs:["Affiliations link individual Contacts with Organization Accounts in NPSP, allowing you to track a constituent's relationships with organizations such as employers, board memberships, volunteer roles, and family foundations. Each Affiliation record captures the role, status, start and end dates, and whether it is the Primary Affiliation.","A Contact can have multiple Affiliations but only one Primary Affiliation at a time. When you set a new Affiliation to Primary, NPSP automatically switches the existing Primary Affiliation's status to Former and deselects its Primary checkbox.","When importing data using NPSP Data Importer, placing Contact1 and Account1 on the same row automatically creates a Primary Affiliation between Contact1 and the Account1 Organization Account."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_manage_constituents.htm&language=en_US&type=5"}
  ],
  dataFlow:["Contact","npe5__Affiliation__c","Organization Account"],
  connections:[{planet:"contacts",desc:"Contacts are affiliated with organizations"},{planet:"donations",desc:"Employment affiliations identify matching gift eligibility"}]
},

engagement: {
  name: "Engagement Plans",
  icon: "\u{1F4CB}",
  color: "#84cc16",
  description: "Templated sequences of Tasks for stewardship workflows. 12 EP_ classes. Templates define tasks with dependencies, delays, and assignment rules. Apply a template to a Contact, Account, or Opportunity and Tasks auto-generate. Task completion rolls up to the engagement plan.",
  components: [
    {id:"ep-core",name:"Plan Engine",icon:"\u{2699}\uFE0F",desc:"EP_EngagementPlans_TDTM validates plan lookups (BeforeInsert) and creates Tasks from templates (AfterInsert). Validates that each plan links to exactly one parent object. Uses DML options for email sending on certain tasks.",tags:["EP_EngagementPlans_TDTM","Engagement_Plan__c","Engagement_Plan_Template__c"],triggerTags:["before insert","after insert"],code:{title:"EP_EngagementPlans_TDTM.cls",lang:"Apex",body:'<span class="kw">public with sharing class</span>\n  <span class="ty">EP_EngagementPlans_TDTM</span>\n  <span class="kw">extends</span> <span class="ty">TDTM_Runnable</span> {\n\n  <span class="kw">public override</span> <span class="ty">DmlWrapper</span> <span class="fn">run</span>(...) {\n    <span class="kw">if</span> (triggerAction ==\n        <span class="ty">Action</span>.BeforeInsert) {\n      <span class="kw">for</span> (<span class="ty">Engagement_Plan__c</span> ep : newlist){\n        <span class="cm">// Validate exactly one parent lookup</span>\n        <span class="ty">String</span> targetField =\n          <span class="ty">EP_EngagementPlans_UTIL</span>\n            .<span class="fn">getTargetObjectField</span>(ep, <span class="kw">true</span>);\n      }\n    }\n    <span class="cm">// AfterInsert: Creates Task records</span>\n    <span class="cm">// from EP_Task definitions in template</span>\n  }\n}'},executionFlow:["Admin creates Engagement_Plan_Template__c with task definitions","User applies template to Contact/Account/Opportunity","EP_EngagementPlans_TDTM validates (BeforeInsert)","Creates Task records based on template definitions","EP_TaskDependency_TDTM manages task dependency chains","EP_TaskRollup_TDTM rolls up completion to plan"],docs:["NPSP Engagement Plans let you create a set of predefined tasks that help you engage with constituents for major gifts, volunteer management, grant-making, client management, and more. The system uses three custom objects: Engagement Plan Template, Engagement Plan, and Engagement Plan Task.","When you assign an Engagement Plan Template to a record, NPSP automatically creates all the tasks defined in the template with appropriate due dates and assignees. Engagement Plans can be kicked off manually or automatically when used in conjunction with Levels.","Each template can be configured with options for Default Assignee (the user creating the plan or the record owner), Skip Weekends (auto-adjusts due dates), and Reschedule To (which day to push weekend tasks to). Templates are managed from the Engagement Plan Templates tab."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Config_Engage_Plans.htm&language=en_US&type=5"},
    {id:"ep-tasks",name:"Task Management",icon:"\u{1F4DD}",desc:"EP_TaskRollup_TDTM rolls up task completion status. EP_TaskDependency_TDTM manages dependency chains (task B starts when task A completes). EP_EngagementPlanTaskValidation_TDTM validates task definitions.",tags:["EP_TaskRollup_TDTM","EP_TaskDependency_TDTM","Engagement_Plan_Task__c"],triggerTags:["after update"],docs:["Engagement Plan Tasks support dependency chains where child tasks wait for their parent task to complete before becoming active. Dependent tasks start with a status of \"Waiting on Dependent Task\" and automatically update to \"Not Started\" when the parent task is completed.","The Automatically Update Child Task Due Date setting on the template controls whether dependent task due dates are calculated from the parent task's actual completion date rather than its original due date.","As tasks are completed, the Engagement Plan status progresses from Not Started to In Progress and finally to Complete when the last task is finished. The Total EP Tasks and Completed Tasks fields provide a summary of overall progress."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Config_Engage_Plans.htm&language=en_US&type=5"}
  ],
  dataFlow:["Template","Engagement_Plan__c","Task Records","Completion Rollup"],
  connections:[{planet:"contacts",desc:"Plans assigned to Contacts"},{planet:"donations",desc:"Plans triggered by donation events"}]
},

bdi: {
  name: "Batch Data Import (BDI)",
  icon: "\u{1F4E5}",
  color: "#d97706",
  description: "Powerful data import engine with 66 Apex classes. Loads donations, contacts, and records through a staging object (DataImport__c). Custom metadata field/object mappings (Data_Import_Field_Mapping__mdt, Data_Import_Object_Mapping__mdt). Donation matching prevents duplicates. Gift Entry UI is built on top of BDI.",
  components: [
    {id:"bdi-batch",name:"BDI Batch Processor",icon:"\u{2699}\uFE0F",desc:"BDI_DataImport_BATCH implements Database.Batchable. Processes DataImport__c staging records: matches/creates Contacts, Accounts, Opportunities, Payments, Allocations, and other mapped objects. BDI_MatchDonations prevents duplicate donations.",tags:["BDI_DataImport_BATCH","BDI_DataImportService","BDI_MatchDonations"],triggerTags:["batch"],code:{title:"BDI_DataImport_BATCH.cls",lang:"Apex",body:'<span class="kw">public class</span> <span class="ty">BDI_DataImport_BATCH</span>\n  <span class="kw">implements</span> <span class="ty">Database.Batchable&lt;sObject&gt;</span> {\n\n  <span class="kw">private</span> <span class="ty">BDI_DataImportService</span>\n    dataImportService;\n  <span class="kw">public</span> <span class="ty">Data_Import_Settings__c</span> diSettings;\n  <span class="kw">public</span> <span class="ty">Id</span> batchId;\n  <span class="kw">public</span> <span class="ty">Boolean</span> isFromGiftEntryUI;\n\n  <span class="cm">// Processes DataImport__c records:</span>\n  <span class="cm">//   1. Contacts and Accounts</span>\n  <span class="cm">//   2. Opportunities (with matching)</span>\n  <span class="cm">//   3. Payments</span>\n  <span class="cm">//   4. Allocations</span>\n  <span class="cm">//   5. Other mapped objects</span>\n}'},executionFlow:["DataImport__c staging records created","BDI_DataImport_BATCH processes in batches","BDI_MappingService resolves field mappings from CMDT","BDI_MatchDonations checks for existing Opportunities","Creates/updates Contacts, Accounts, Opportunities","Creates Payments and Allocations","Updates DataImport__c status fields"],docs:["The NPSP Data Importer processes records through the NPSP Data Import staging object, creating or updating Contacts, Accounts, Opportunities, Payments, and other target objects from a single denormalized row of data. This eliminates the need to import multiple spreadsheets in sequence.","The NPSP Batch Data Import feature lets you group data import records into batches with their own configuration options for matching rules and batch size. The NPSP 09 scheduled job can automatically process batches marked with Process Using Scheduled Job on a nightly basis.","The default batch process size is 50 records. If records fail due to system errors like CPU time limits, reduce the batch size. You can run a Dry Run before processing to identify potential duplicate matches without actually importing records."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Data_Importer.htm&language=en_US&type=5"},
    {id:"bdi-mapping",name:"Field Mapping Engine",icon:"\u{1F5FA}",desc:"BDI_MappingService resolves field-to-field mappings via Data_Import_Field_Mapping__mdt CMDT. BDI_ObjectMappingLogic handles object creation/matching via Data_Import_Object_Mapping__mdt. LWC components: bdiFieldMappings, bdiObjectMappings.",tags:["BDI_MappingService","BDI_ObjectMappingLogic","Data_Import_Field_Mapping__mdt","Data_Import_Object_Mapping__mdt"],triggerTags:["config"],docs:["Advanced Mapping is the logic that powers the NPSP Data Importer, Gift Entry, and Elevate. It uses Custom Metadata Type (CMDT) records to connect fields on the NPSP Data Import staging object to fields on target objects like Account, Contact, and Opportunity.","Field Mappings connect individual fields between the staging and target objects, while Object Groups are containers that hold collections of Field Mappings and define what record types to create. Advanced Mapping comes pre-configured for typical scenarios, but can be customized to include custom fields or entirely new objects.","To customize Advanced Mapping, create staging fields on the NPSP Data Import object, optionally create a new Object Group for unmapped objects, and then create Field Mapping records. Configuration is done in NPSP Settings under System Tools, Advanced Mapping."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Data_Importer.htm&language=en_US&type=5"},
    {id:"bdi-triggers",name:"BDI Trigger Handlers",icon:"\u{26A1}\uFE0F",desc:"BDI_DataImportBatch_TDTM fires on DataImportBatch__c (BeforeInsert). BDI_DataImportBatchStatus_TDTM tracks batch status via DataImport__c record counts.",tags:["BDI_DataImportBatch_TDTM","BDI_DataImportBatchStatus_TDTM","DataImport__c","DataImportBatch__c"],triggerTags:["before insert"],docs:["During import processing, the NPSP Data Importer updates each NPSP Data Import record with status information indicating whether the record succeeded or failed. Each target object has its own Import Status field showing Created, Matched, or an error message.","The Batch Status field on the NPSP Data Import Batch object tracks the overall state: Open (not yet processed), Completed (all records processed), or Failed (one or more records failed). Failed records contain error details in the Failure Information field and can be reprocessed after resolving the underlying issues.","The NPSP Data Importer can partially succeed, creating some target records while failing on others, so checking individual Import Status fields on each record is important for troubleshooting."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Data_Importer.htm&language=en_US&type=5"}
  ],
  dataFlow:["DataImport__c (staging)","BDI_MappingService","Match/Create","Contact + Account + Opportunity","Payment + Allocation"],
  connections:[{planet:"giftentry",desc:"Gift Entry UI is built on BDI"},{planet:"donations",desc:"Creates Opportunities and Payments"},{planet:"contacts",desc:"Creates/matches Contacts and Accounts"},{planet:"allocations",desc:"Creates allocations during import"}]
},

giftentry: {
  name: "Gift Entry",
  icon: "\u{1F381}",
  color: "#0ea5e9",
  description: "Modern Lightning-based gift entry built on BDI. 10 GE_ classes, 9 BGE_ classes, 20+ LWC components. Form templates (Form_Template__c) drive dynamic form rendering. Supports single entry, batch entry with table views, Elevate card tokenization, donation matching, soft credit and allocation widgets.",
  components: [
    {id:"ge-form",name:"Gift Entry Forms",icon:"\u{1F4DD}",desc:"geGiftEntryFormApp is the main LWC. geFormRenderer dynamically renders fields from template JSON. geFormField, geFormSection handle individual elements. geFormWidgetAllocation and geFormWidgetSoftCredit provide inline allocation/soft credit entry.",tags:["GE_GiftEntryController","geGiftEntryFormApp","geFormRenderer"],triggerTags:["LWC"],code:{title:"Gift Entry Data Flow",lang:"JavaScript",body:'<span class="cm">// Gift Entry LWC Architecture:</span>\n<span class="cm">// geGiftEntryFormApp coordinates:</span>\n<span class="cm">//   geFormRenderer - renders from template JSON</span>\n<span class="cm">//   geFormWidgetAllocation - allocation splits</span>\n<span class="cm">//   geFormWidgetSoftCredit - soft credit entry</span>\n<span class="cm">//   geFormWidgetTokenizeCard - Elevate card</span>\n<span class="cm">//   geDonationMatching - finds matches</span>\n<span class="cm">//</span>\n<span class="cm">// Data flow:</span>\n<span class="cm">// User fills form</span>\n<span class="cm">//   -> DataImport__c staging record created</span>\n<span class="cm">//   -> BDI_DataImport_BATCH processes</span>\n<span class="cm">//   -> Opportunity + Payment created</span>'},executionFlow:["User opens Gift Entry page","geFormRenderer loads Form_Template__c JSON","Dynamic form rendered with configured fields","User enters donation data","DataImport__c staging record created","BDI_DataImport_BATCH processes the record","Opportunity, Payment, Allocations created"],docs:["Gift Entry provides a robust form-based interface for entering gifts into NPSP, either individually or in batches. The New Gift action can be added to Account and Contact page layouts so users can create a gift directly from a record.","Gift Entry is built on Lightning Web Components and requires Advanced Mapping to be enabled first. The form dynamically renders fields based on the selected Gift Entry template, supporting standard and custom fields configured through Advanced Mapping.","To enable Gift Entry, first enable Advanced Mapping in NPSP Settings under System Tools, then enable Gift Entry on the same page. Users need access to specific Apex classes including GE_GiftEntryController and BGE_BatchGiftEntry_UTIL."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Gift_Entry.htm&language=en_US&type=5"},
    {id:"ge-batch",name:"Batch Gift Entry",icon:"\u{1F4CB}",desc:"geBatchGiftEntryHeader + geBatchGiftEntryTable provide batch entry with spreadsheet-like table views. geBatchWizard creates new batches. BGE_FormTemplate_TDTM prevents deletion of active templates.",tags:["BGE_FormTemplate_TDTM","geBatchGiftEntryTable","DataImportBatch__c"],triggerTags:["before delete"],docs:["Batch Gift Entry allows users to enter multiple gifts in a batch using a spreadsheet-like interface, with each batch having its own configuration options for matching rules and processing behavior. The Gift Entry tab contains a Batches subtab showing all data batches created by users.","Each batch tracks its processing status including Last Processed On, Records Successfully Processed, and Records Failed fields. When a batch number format is active, NPSP automatically attaches batch numbers to Opportunities and Payments created as part of the batch for audit purposes.","You can customize which columns appear on the Batches list view from the Gift Entry tab using the Select Fields to Display option."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Gift_Entry.htm&language=en_US&type=5"},
    {id:"ge-templates",name:"Template Builder",icon:"\u{1F3A8}",desc:"geTemplateBuilder provides a drag-and-drop form designer. Templates stored as JSON in Form_Template__c. geTemplates shows template list view. GE_Template manages template CRUD operations.",tags:["geTemplateBuilder","Form_Template__c","GE_Template"],triggerTags:["config"],docs:["Gift Entry Templates are drag-and-drop form designs stored in the Form_Template__c object that define which fields appear on a Gift Entry form and in what order. The Templates tab in Gift Entry shows all form templates in your org.","The Template Builder lets you add, remove, and reorder form fields organized into sections. Fields available for templates correspond to the objects and fields configured in Advanced Mapping, including standard fields for Contacts, Accounts, Opportunities, Payments, GAU Allocations, and Recurring Donations.","When adjusting templates to auto-populate Contact address information, you may need to remap address fields in Advanced Mapping from the Address object to the Contact1 object, then update your templates to use the remapped fields."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Gift_Entry_Templates.htm&language=en_US&type=5"}
  ],
  dataFlow:["Form Template","User Input","DataImport__c","BDI Processing","Opportunity + Payment"],
  connections:[{planet:"bdi",desc:"Gift Entry uses BDI as processing engine"},{planet:"donations",desc:"Creates Opportunities and Payments"},{planet:"elevate",desc:"Card tokenization during entry"},{planet:"softcredits",desc:"Soft credit widget in forms"},{planet:"allocations",desc:"Allocation widget in forms"}]
},

levels: {
  name: "Levels (Donor Tiers)",
  icon: "\u{1F3C6}",
  color: "#10b981",
  description: "Assigns donor tiers based on rollup field values. 6 LVL_ classes. For example, donors giving $10,000+ lifetime auto-assigned 'Major Donor' level. Levels target Account, Contact, or any object. LVL_LevelAssign_BATCH evaluates all records nightly against Level__c criteria definitions.",
  components: [
    {id:"lvl-engine",name:"Level Assignment Engine",icon:"\u{2699}\uFE0F",desc:"LVL_Level_TDTM validates Level__c records (BeforeInsert/BeforeUpdate). LVL_LevelAssign_BATCH runs nightly: queries all Level__c definitions, evaluates records against min/max criteria, assigns appropriate level and tracks previous level.",tags:["LVL_Level_TDTM","LVL_LevelAssign_BATCH","Level__c","Levels_Settings__c"],triggerTags:["before insert","nightly batch"],code:{title:"Level Assignment Pattern",lang:"Apex",body:'<span class="cm">// Level validation and batch assignment</span>\nhandlers.add(<span class="kw">new</span> <span class="ty">Trigger_Handler__c</span>(\n  Class__c = <span class="st">\'LVL_Level_TDTM\'</span>,\n  Load_Order__c = <span class="nu">1</span>,\n  Object__c = <span class="st">\'Level__c\'</span>,\n  Trigger_Action__c =\n    <span class="st">\'BeforeInsert;BeforeUpdate\'</span>\n));\n\n<span class="cm">// LVL_LevelAssign_BATCH nightly:</span>\n<span class="cm">// 1. Query all Level__c definitions</span>\n<span class="cm">// 2. For each target object, query records</span>\n<span class="cm">// 3. Assign level based on field value ranges</span>\n<span class="cm">// 4. Update Previous_Level__c and Level__c</span>\n<span class="cm">//</span>\n<span class="cm">// Example Level__c record:</span>\n<span class="cm">//   Name: "Major Donor"</span>\n<span class="cm">//   Target: Contact</span>\n<span class="cm">//   Source_Field: npo02__TotalOppAmount__c</span>\n<span class="cm">//   Minimum_Amount: 10000</span>\n<span class="cm">//   Maximum_Amount: null (no cap)</span>'},executionFlow:["Admin defines Level__c records with criteria","LVL_Level_TDTM validates on save","Nightly: LVL_LevelAssign_BATCH runs","Queries Level__c definitions by target object","Evaluates each record against min/max thresholds","Assigns Level__c lookup, tracks Previous_Level__c"],docs:["NPSP Levels lets you track your constituents' level of commitment and engagement based on criteria such as total gifts or number of hours volunteered. Each Level record you configure indicates a particular tier, such as Gold, Bronze, or Silver, that can be assigned to Contacts, Accounts, or other objects.","Levels uses lookup relationship fields (Level and Previous Level) on the target object. A nightly batch job (LVL_LevelAssign_BATCH) automatically evaluates each record against configured Level definitions and updates the Level and Previous Level fields.","To configure Levels, enable object and field-level security for the Level object on each profile, create Level and Previous Level lookup fields on your target objects, and optionally add custom objects to the Target picklist on the Level object."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_config_levels.htm&language=en_US&type=5"}
  ],
  dataFlow:["Level__c (definition)","Rollup Fields","LVL_LevelAssign_BATCH","Contact/Account Level Assignment"],
  connections:[{planet:"rollups",desc:"Level criteria based on rollup summary fields"},{planet:"contacts",desc:"Levels assigned to Contacts and Accounts"},{planet:"batch",desc:"LVL_LevelAssign_BATCH runs nightly"}]
},

errors: {
  name: "Error Handling",
  icon: "\u{26A0}\uFE0F",
  color: "#d946ef",
  description: "Centralized error framework with 22 ERR_ classes. Catches exceptions from TDTM handlers, logs to Error__c custom object, optionally sends email notifications. ERR_Handler processes DML results, ERR_Notifier sends alerts, ERR_ExceptionHandler converts exceptions, ERR_RecordError tracks record-level issues.",
  components: [
    {id:"err-handler",name:"Error Handler",icon:"\u{1F6A8}",desc:"ERR_Handler is the core processor. Converts Database.SaveResult/UpsertResult to Error__c records with full context (stack trace, record IDs, handler name). Does NOT store errors directly; caller handles after rollback.",tags:["ERR_Handler","ERR_ExceptionHandler","Error__c"],triggerTags:["system"],code:{title:"ERR_Handler Pattern",lang:"Apex",body:'<span class="kw">public class</span> <span class="ty">ERR_Handler</span> {\n\n  <span class="kw">public class</span> <span class="ty">Errors</span> {\n    <span class="kw">public</span> <span class="ty">Boolean</span> errorsExist = <span class="kw">false</span>;\n    <span class="kw">public</span> <span class="ty">List&lt;Error__c&gt;</span> errorRecords =\n      <span class="kw">new</span> <span class="ty">List&lt;Error__c&gt;</span>();\n  }\n\n  <span class="cm">// Processes DML results:</span>\n  <span class="cm">// 1. Iterates SaveResult[]</span>\n  <span class="cm">// 2. Creates Error__c with full context</span>\n  <span class="cm">// 3. Caller handles after rollback</span>\n  <span class="cm">// 4. ERR_Notifier sends email alerts</span>\n}'},executionFlow:["TDTM handler throws exception or DML fails","ERR_Handler.processErrors() called","Creates Error__c records with stack trace and context","ERR_Notifier checks Error_Settings__c","Sends email notification if configured","Admin reviews errors in NPSP Settings"],docs:["NPSP error handling centrally traps, collects, and stores errors in a single location. When enabled, errors that occur during NPSP operations are captured with context including the date and time, error type, full message, object type, a link to the record, and a stack trace.","Errors are stored as Error__c records and can be viewed from the NPSP Settings tab under System Tools, then Error Log. An hourly scheduled job (ERR_AsyncErrors_SCHED) processes asynchronous errors.","To enable error handling, navigate to the NPSP Settings tab, click System Tools, then Error Notifications, click Edit, and select Store Errors."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Configure_Error_Handling.htm&language=en_US&type=5"},
    {id:"err-notifier",name:"Error Notification",icon:"\u{1F4E7}",desc:"ERR_Notifier sends email alerts for errors. Configurable via Error_Settings__c (notification recipients, frequency). errRecordLog LWC provides error log viewer in Settings UI.",tags:["ERR_Notifier","Error_Settings__c","errRecordLog"],triggerTags:["notification"],docs:["NPSP can send email notifications when errors occur during scheduled jobs and other automated processes. If the Submitted By user for NPSP scheduled jobs is not an active Salesforce user, administrators will receive error messages and nightly rollups will not be updated correctly.","Error notification preferences are configured through Error_Settings__c custom settings. You can control whether errors are stored, who receives notifications, and how they are delivered.","To configure error notifications, go to the NPSP Settings tab, click System Tools, then Error Notifications, click Edit, and make selections appropriate for your org."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Configure_Error_Handling.htm&language=en_US&type=5"},
    {id:"err-record",name:"Record-Level Errors",icon:"\u{1F4DD}",desc:"ERR_RecordError tracks errors at the individual record level. Enables retry logic and targeted error resolution. Error__c stores object type, record ID, error message, stack trace, and handler class name.",tags:["ERR_RecordError","Error__c"],triggerTags:["tracking"],docs:["Each NPSP error is stored as an individual Error__c record with fields that provide context for debugging: DateTime, Error Type, Full Message, Object Type, Record URL, and Stack Trace.","Record-level errors are linked to the specific record that caused the issue when that information is available at runtime. This allows administrators to navigate directly from the error log to the problematic record for troubleshooting.","View record-level errors from the NPSP Settings tab under System Tools, then Error Log. Errors are only stored when the Store Errors option is enabled in Error Notifications settings."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Configure_Error_Handling.htm&language=en_US&type=5"}
  ],
  dataFlow:["Exception/DML Failure","ERR_Handler","Error__c Record","ERR_Notifier","Admin Review"],
  connections:[{planet:"tdtm",desc:"Errors caught from TDTM handler chain"},{planet:"settings",desc:"Error_Settings__c configures notifications"},{planet:"batch",desc:"Batch job errors logged through ERR_Handler"}]
},

settings: {
  name: "Settings & Configuration",
  icon: "\u{2699}\uFE0F",
  color: "#64748b",
  description: "All config stored in 14+ Custom Settings objects, managed through UTIL_CustomSettingsFacade (unified facade with in-memory caching). 64 STG_ classes for Visualforce settings panels. LWC: gsChecklist, gsChecklistSetup for getting-started wizard. STG_InstallScript handles package install/upgrade.",
  components: [
    {id:"settings-facade",name:"Settings Facade",icon:"\u{1F3E0}",desc:"UTIL_CustomSettingsFacade provides unified access to all 14+ custom settings with in-memory caching. Every NPSP handler calls this facade. Settings objects include: Contacts_And_Orgs, Households, Recurring_Donations, Relationships, Allocations, Rollups, Data_Import, Error, Address_Verification, Levels, Gift_Entry, and more.",tags:["UTIL_CustomSettingsFacade","npe01__Contacts_And_Orgs_Settings__c","npo02__Households_Settings__c"],triggerTags:["foundation"],code:{title:"UTIL_CustomSettingsFacade.cls",lang:"Apex",body:'<span class="kw">public without sharing class</span>\n  <span class="ty">UTIL_CustomSettingsFacade</span> {\n\n  <span class="cm">// In-memory caching for all settings</span>\n  <span class="kw">static</span> <span class="ty">npe01__Contacts_And_Orgs_Settings__c</span>\n    contactsSettings;\n  <span class="kw">static</span> <span class="ty">npo02__Households_Settings__c</span>\n    householdsSettings;\n  <span class="kw">static</span> <span class="ty">npe03__Recurring_Donations_Settings__c</span>\n    recurringDonationsSettings;\n  <span class="kw">static</span> <span class="ty">Allocations_Settings__c</span>\n    allocationsSettings;\n  <span class="kw">static</span> <span class="ty">Customizable_Rollup_Settings__c</span>\n    customizableRollupSettings;\n  <span class="kw">static</span> <span class="ty">Data_Import_Settings__c</span>\n    dataImportSettings;\n  <span class="cm">// ... 14+ settings objects cached</span>\n\n  <span class="cm">// Usage throughout NPSP:</span>\n  <span class="cm">// PMT_Payment_TDTM:</span>\n  <span class="cm">//   getContactsSettings()</span>\n  <span class="cm">//     .Enforce_Accounting_Data_Consistency__c</span>\n  <span class="cm">// ALLO_Allocations_TDTM:</span>\n  <span class="cm">//   getAllocationsSettings()</span>\n}'},executionFlow:["Handler needs configuration value","Calls UTIL_CustomSettingsFacade.getXxxSettings()","Facade checks in-memory cache","If cached, returns immediately (no query)","If not cached, queries Custom Setting and caches","Returns settings object to caller"],docs:["NPSP manages its configuration through a set of custom settings objects covering areas such as Contacts and Organizations, Recurring Donations, Relationships, Affiliations, Allocations, Data Import, Error Settings, Household Settings, and more. These settings control key NPSP behaviors and feature toggles across the entire package.","The UTIL_CustomSettingsFacade class provides a unified, cached access layer for all NPSP custom settings. It is invoked throughout the codebase whenever settings values are needed, ensuring consistent reads and avoiding redundant SOQL queries.","Custom settings can be managed from NPSP Settings in the Salesforce UI, or directly in Setup under Custom Settings."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_install_configure.htm&language=en_US&type=5"},
    {id:"settings-ui",name:"Settings UI",icon:"\u{1F5A5}",desc:"64 STG_ classes provide Visualforce settings panels organized by domain: Donations, People, Recurring Donations, Bulk Data, System Tools. LWC getting-started: gsChecklist, gsChecklistSetup, gsApplicationStatus, gsResources.",tags:["STG_Panel","STG_PanelTDTM_CTRL","gsChecklist"],triggerTags:["UI"],docs:["Almost all NPSP configuration is managed from the NPSP Settings tab, where administrators can change key behaviors, enable features, run system health checks, and view error logs. The tab is accessible to system admins and users with Author Apex, Customize Application, and Modify All Data permissions.","The settings interface is organized into sections including People, Donations, Bulk Data Processes, System Tools, and Recurring Donations. Each section contains Visualforce panels that expose the underlying custom settings for editing. NPSP also includes a Getting Started page with a step-by-step checklist.","To access NPSP Settings, click the NPSP Settings tab or find it in the App Launcher. If the tab is not visible, ensure the profile has the correct tab visibility and the required system permissions."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.npsp_install_configure.htm&language=en_US&type=5"},
    {id:"health-check",name:"Health Check & Install",icon:"\u{1FA7A}",desc:"STG_PanelHealthCheck validates: TDTM handler registration, required fields, rollup definitions, record type mappings, configuration conflicts. STG_InstallScript handles package install and upgrade logic.",tags:["STG_PanelHealthCheck","STG_InstallScript"],triggerTags:["diagnostic"],docs:["Health Check looks through your NPSP org for both data and configuration inconsistencies or errors and reports back the type of error along with a description. It validates Opportunity Contact Roles, Account model data, Recurring Donation stages, and Household object data.","You can optionally select Disable Record Data Health Checks to skip record-level checks and only validate NPSP configuration settings. This is recommended for organizations with a large volume of records where Health Check has difficulty completing.","The install script handles NPSP package upgrades by automatically recreating default scheduled jobs and configuring new features. To run Health Check, navigate to NPSP Settings, click System Tools, then Health Check, and click Run Health Check."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.NPSP_Run_Health_Check.htm&language=en_US&type=5"}
  ],
  dataFlow:["Admin UI","Custom Settings (14+)","UTIL_CustomSettingsFacade","Handler Behavior","Batch Schedules"],
  connections:[{planet:"tdtm",desc:"Handler records managed via Settings"},{planet:"rollups",desc:"Rollup definitions through Settings UI"},{planet:"batch",desc:"Batch sizes and schedules in Settings"},{planet:"errors",desc:"Error notification configured in Settings"}]
},

elevate: {
  name: "Payment Services (Elevate)",
  icon: "\u{1F4B3}",
  color: "#7c3aed",
  description: "Integration with Salesforce Elevate for payment processing. 14 PS_ classes. Handles credit card tokenization, payment capture, refunds, and recurring payment management. LWC components handle card entry and token management.",
  components: [
    {id:"ps-core",name:"Payment Integration",icon:"\u{1F310}",desc:"PS_CommitmentRequest builds Elevate commitment requests for recurring payments. PS_Request is the base request builder. PS_IntegrationService handles HTTP callouts to Elevate APIs. Configuration in Payment_Services_Configuration__c.",tags:["PS_CommitmentRequest","PS_Request","PS_IntegrationService","Payment_Services_Configuration__c"],triggerTags:["callout"],code:{title:"Payment Services Architecture",lang:"Apex",body:'<span class="cm">// Payment Services integration:</span>\n<span class="cm">// PS_CommitmentRequest - recurring payment JSON</span>\n<span class="cm">// PS_Request - base class for Elevate API</span>\n<span class="cm">// PS_IntegrationService - HTTP callout mgmt</span>\n<span class="cm">//</span>\n<span class="cm">// LWC flow:</span>\n<span class="cm">// geFormWidgetTokenizeCard</span>\n<span class="cm">//   -> iframe -> Elevate tokenization service</span>\n<span class="cm">//   -> token returned</span>\n<span class="cm">//   -> stored on</span>\n<span class="cm">//      DataImport__c.Payment_Method_Token__c</span>\n<span class="cm">//   -> BDI processing captures payment</span>\n<span class="cm">//      via Elevate API</span>'},executionFlow:["User enters card in geFormWidgetTokenizeCard","Iframe communicates with Elevate tokenization","Token returned and stored on DataImport__c","BDI processes the staging record","PS_IntegrationService captures payment via Elevate API","Payment confirmation stored on npe01__OppPayment__c"],docs:["Elevate by Salesforce.org is a payment processing platform that integrates with NPSP through Gift Entry and Recurring Donations. Transactions flow from Elevate into NPSP via Advanced Mapping field mappings that connect NPSP Data Import fields to Payment and Opportunity objects.","NPSP includes pre-configured field mappings for Elevate payment data including authorization dates, card expiration details, gateway IDs, payment status, transaction fees, and donor-covered amounts. These mappings should not be modified, as changes could cause issues with payment processing.","To use Elevate with NPSP, you must enable Advanced Mapping and Gift Entry in NPSP Settings under System Tools. Users need access to the GE_PaymentServices Apex class, and the Gift Entry permission set must be assigned."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.EL_Configuration.htm&language=en_US&type=5"},
    {id:"ps-lwc",name:"Payment UI Components",icon:"\u{1F4BB}",desc:"geFormWidgetTokenizeCard for card entry, gePaymentGatewayManagement for gateway config, rd2EditPaymentInformationModal and rd2ElevateCreditCardForm for recurring donation payment editing, refundPayment for refunds.",tags:["geFormWidgetTokenizeCard","rd2ElevateCreditCardForm","refundPayment"],triggerTags:["LWC"],docs:["Gift Entry provides Lightning Web Components for collecting payment information directly within Salesforce. Users can enter gifts individually or in batches using consistent form templates, with payment fields for check or reference numbers, payment method, payment amount, and scheduled dates.","The Gift Entry form templates are configured from the Gift Entry tab under Templates. Each template defines which fields appear on the form, including payment-related fields. The New Gift action can be added to Account and Contact page layouts so users can create gifts with payment information directly from those records.","To set up payment UI components, enable Gift Entry in NPSP Settings, add the New Gift action to page layouts, assign the Gift Entry Recommended permission set to users, and grant object permissions for Form Templates, NPSP Data Import Batches, NPSP Data Imports, and Payments."],docUrl:"https://help.salesforce.com/s/articleView?id=sfdo.EL_Configuration.htm&language=en_US&type=5"}
  ],
  dataFlow:["Card Entry (LWC)","Elevate Tokenization","Token Storage","BDI Processing","Payment Capture"],
  connections:[{planet:"giftentry",desc:"Card tokenization during gift entry"},{planet:"recurring",desc:"Recurring payment processing"},{planet:"donations",desc:"Payment capture and refunds"}]
}

};
